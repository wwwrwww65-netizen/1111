(()=>{var e={};e.id=351,e.ids=[351],e.modules={7849:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external")},2934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},5403:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external")},4580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},4749:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external")},5869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},1962:(e,t,r)=>{"use strict";r.r(t),r.d(t,{GlobalError:()=>i.a,__next_app__:()=>m,originalPathname:()=>u,pages:()=>c,routeModule:()=>p,tree:()=>d}),r(8671),r(687),r(861);var s=r(5962),a=r(3241),n=r(2233),i=r.n(n),l=r(9707),o={};for(let e in l)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(o[e]=()=>l[e]);r.d(t,o);let d=["",{children:["products",{children:["[id]",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(r.bind(r,8671)),"/workspace/apps/web/src/app/products/[id]/page.tsx"]}]},{}]},{}]},{layout:[()=>Promise.resolve().then(r.bind(r,687)),"/workspace/apps/web/src/app/layout.tsx"],"not-found":[()=>Promise.resolve().then(r.bind(r,861)),"/workspace/apps/web/src/app/not-found.tsx"]}],c=["/workspace/apps/web/src/app/products/[id]/page.tsx"],u="/products/[id]/page",m={require:r,loadChunk:()=>Promise.resolve()},p=new s.AppPageRouteModule({definition:{kind:a.x.APP_PAGE,page:"/products/[id]/page",pathname:"/products/[id]",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:d}})},46:(e,t,r)=>{Promise.resolve().then(r.bind(r,4631))},4631:(e,t,r)=>{"use strict";let s,a,n,i,l,o;r.r(t),r.d(t,{default:()=>S});var d=r(2281),c=r(6856),u=r(192),m=r(4051),p=r.n(m),x=r(5533),h=r(5021);let g=e=>{let t;let r=new Set,s=(e,s)=>{let a="function"==typeof e?e(t):e;if(!Object.is(a,t)){let e=t;t=(null!=s?s:"object"!=typeof a||null===a)?a:Object.assign({},t,a),r.forEach(r=>r(t,e))}},a=()=>t,n={setState:s,getState:a,subscribe:e=>(r.add(e),()=>r.delete(e)),destroy:()=>{console.warn("[DEPRECATED] The `destroy` method will be unsupported in a future version. Instead use unsubscribe function returned by subscribe. Everything will be garbage-collected if store is garbage-collected."),r.clear()}};return t=e(s,a,n),n},b=e=>e?g(e):g;var v=r(1635);let{useDebugValue:f}=m,{useSyncExternalStoreWithSelector:y}=v,j=!1,w=e=>t=>{try{let r=e(t);if(r instanceof Promise)return r;return{then:e=>w(e)(r),catch(e){return this}}}catch(e){return{then(e){return this},catch:t=>w(t)(e)}}},N=(e=>{"function"!=typeof e&&console.warn("[DEPRECATED] Passing a vanilla store will be unsupported in a future version. Instead use `import { useStore } from 'zustand'`.");let t="function"==typeof e?b(e):e,r=(e,r)=>(function(e,t=e.getState,r){r&&!j&&(console.warn("[DEPRECATED] Use `createWithEqualityFn` instead of `create` or use `useStoreWithEqualityFn` instead of `useStore`. They can be imported from 'zustand/traditional'. https://github.com/pmndrs/zustand/discussions/1937"),j=!0);let s=y(e.subscribe,e.getState,e.getServerState||e.getState,t,r);return f(s),s})(t,e,r);return Object.assign(r,t),r})((s=(e,t)=>({user:null,token:null,isAuthenticated:!1,isLoading:!1,error:null,login:(t,r)=>e({user:t,token:r,isAuthenticated:!0,error:null}),logout:()=>e({user:null,token:null,isAuthenticated:!1,error:null}),setLoading:t=>e({isLoading:t}),setError:t=>e({error:t}),updateUser:t=>e(e=>({user:e.user?{...e.user,...t}:null}))}),"getStorage"in(a={name:"auth-storage",partialize:e=>({user:e.user,token:e.token,isAuthenticated:e.isAuthenticated})})||"serialize"in a||"deserialize"in a?(console.warn("[DEPRECATED] `getStorage`, `serialize` and `deserialize` options are deprecated. Use `storage` option instead."),n=s,i=a,(e,t,r)=>{let s,a,l={getStorage:()=>localStorage,serialize:JSON.stringify,deserialize:JSON.parse,partialize:e=>e,version:0,merge:(e,t)=>({...t,...e}),...i},o=!1,d=new Set,c=new Set;try{s=l.getStorage()}catch(e){}if(!s)return n((...t)=>{console.warn(`[zustand persist middleware] Unable to update item '${l.name}', the given storage is currently unavailable.`),e(...t)},t,r);let u=w(l.serialize),m=()=>{let e;let r=u({state:l.partialize({...t()}),version:l.version}).then(e=>s.setItem(l.name,e)).catch(t=>{e=t});if(e)throw e;return r},p=r.setState;r.setState=(e,t)=>{p(e,t),m()};let x=n((...t)=>{e(...t),m()},t,r),h=()=>{var r;if(!s)return;o=!1,d.forEach(e=>e(t()));let n=(null==(r=l.onRehydrateStorage)?void 0:r.call(l,t()))||void 0;return w(s.getItem.bind(s))(l.name).then(e=>{if(e)return l.deserialize(e)}).then(e=>{if(e){if("number"!=typeof e.version||e.version===l.version)return e.state;if(l.migrate)return l.migrate(e.state,e.version);console.error("State loaded from storage couldn't be migrated since no migrate function was provided")}}).then(r=>{var s;return e(a=l.merge(r,null!=(s=t())?s:x),!0),m()}).then(()=>{null==n||n(a,void 0),o=!0,c.forEach(e=>e(a))}).catch(e=>{null==n||n(void 0,e)})};return r.persist={setOptions:e=>{l={...l,...e},e.getStorage&&(s=e.getStorage())},clearStorage:()=>{null==s||s.removeItem(l.name)},getOptions:()=>l,rehydrate:()=>h(),hasHydrated:()=>o,onHydrate:e=>(d.add(e),()=>{d.delete(e)}),onFinishHydration:e=>(c.add(e),()=>{c.delete(e)})},h(),a||x}):(l=s,o=a,(e,t,r)=>{let s,a={storage:function(e,t){let r;try{r=e()}catch(e){return}return{getItem:e=>{var t;let s=e=>null===e?null:JSON.parse(e,void 0),a=null!=(t=r.getItem(e))?t:null;return a instanceof Promise?a.then(s):s(a)},setItem:(e,t)=>r.setItem(e,JSON.stringify(t,void 0)),removeItem:e=>r.removeItem(e)}}(()=>localStorage),partialize:e=>e,version:0,merge:(e,t)=>({...t,...e}),...o},n=!1,i=new Set,d=new Set,c=a.storage;if(!c)return l((...t)=>{console.warn(`[zustand persist middleware] Unable to update item '${a.name}', the given storage is currently unavailable.`),e(...t)},t,r);let u=()=>{let e=a.partialize({...t()});return c.setItem(a.name,{state:e,version:a.version})},m=r.setState;r.setState=(e,t)=>{m(e,t),u()};let p=l((...t)=>{e(...t),u()},t,r),x=()=>{var r,l;if(!c)return;n=!1,i.forEach(e=>{var r;return e(null!=(r=t())?r:p)});let o=(null==(l=a.onRehydrateStorage)?void 0:l.call(a,null!=(r=t())?r:p))||void 0;return w(c.getItem.bind(c))(a.name).then(e=>{if(e){if("number"!=typeof e.version||e.version===a.version)return e.state;if(a.migrate)return a.migrate(e.state,e.version);console.error("State loaded from storage couldn't be migrated since no migrate function was provided")}}).then(r=>{var n;return e(s=a.merge(r,null!=(n=t())?n:p),!0),u()}).then(()=>{null==o||o(s,void 0),s=t(),n=!0,d.forEach(e=>e(s))}).catch(e=>{null==o||o(void 0,e)})};return r.persist={setOptions:e=>{a={...a,...e},e.storage&&(c=e.storage)},clearStorage:()=>{null==c||c.removeItem(a.name)},getOptions:()=>a,rehydrate:()=>x(),hasHydrated:()=>n,onHydrate:e=>(i.add(e),()=>{i.delete(e)}),onFinishHydration:e=>(d.add(e),()=>{d.delete(e)})},a.skipHydration||x(),s||p})));function S({params:e}){let t;let{t:r}=(0,h.QT)(),{data:s,isLoading:a,error:n}=c.S.products.getById.useQuery({id:e.id}),i=c.S,l=c.S.cart.addItem.useMutation(),[o,m]=p().useState(0),[x,g]=p().useState(1),[b,v]=p().useState("desc"),[f,y]=p().useState(null),[j,w]=p().useState(!1),[S,E]=p().useState(!1),[C,P]=p().useState(5),[A,z]=p().useState(""),I=N(e=>e.isAuthenticated),[$,q]=p().useState("newest"),[_,D]=p().useState(null);if(a)return d.jsx("main",{className:"p-8",children:"Loading product..."});if(n)return(0,d.jsxs)("main",{className:"p-8",children:["Error: ",n.message]});if(!s)return d.jsx("main",{className:"p-8",children:"Not found"});let O=s.images&&s.images.length?s.images:["/placeholder-product.jpg"];return(0,d.jsxs)("main",{className:"min-h-screen p-4 md:p-8 max-w-6xl mx-auto",children:[(0,d.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 md:gap-10 items-start",children:[(0,d.jsxs)("div",{children:[d.jsx("div",{className:"relative w-full aspect-square bg-gray-100 rounded",children:d.jsx(u.default,{src:O[o],alt:s.name,fill:!0,className:"object-cover rounded",sizes:"(max-width:768px) 100vw, 50vw"})}),d.jsx("div",{className:"mt-3 grid grid-cols-5 gap-2",children:O.slice(0,5).map((e,t)=>d.jsx("button",{onClick:()=>m(t),className:`relative w-full aspect-square rounded overflow-hidden border ${t===o?"border-black":"border-transparent"}`,"aria-label":`thumbnail-${t}`,children:d.jsx(u.default,{src:e,alt:`${s.name}-${t}`,fill:!0,className:"object-cover"})},t))})]}),(0,d.jsxs)("div",{children:[d.jsx("h1",{className:"text-2xl md:text-3xl font-bold",children:s.name}),(0,d.jsxs)("div",{className:"text-[#800020] text-xl md:text-2xl font-semibold mt-3",children:["$",s.price]}),d.jsx("div",{className:"mt-2",children:s.stockQuantity>0?(0,d.jsxs)("span",{className:"inline-flex items-center text-xs px-2 py-1 rounded-full border border-green-600 text-green-700",children:["متوفر • ",s.stockQuantity]}):d.jsx("span",{className:"inline-flex items-center text-xs px-2 py-1 rounded-full border border-red-600 text-red-700",children:"غير متوفر"})}),(0,d.jsxs)("div",{className:"mt-5 border-b flex items-center gap-6 text-sm",children:[d.jsx("button",{className:`pb-2 ${"desc"===b?"border-b-2 border-[#800020] text-[#800020]":""}`,onClick:()=>v("desc"),children:r("description")}),d.jsx("button",{className:`pb-2 ${"specs"===b?"border-b-2 border-[#800020] text-[#800020]":""}`,onClick:()=>v("specs"),children:r("specs")}),d.jsx("button",{className:`pb-2 ${"reviews"===b?"border-b-2 border-[#800020] text-[#800020]":""}`,onClick:()=>v("reviews"),children:r("reviews")})]}),"desc"===b&&d.jsx("p",{className:"text-gray-700 mt-4 leading-relaxed",children:s.description}),"specs"===b&&(0,d.jsxs)("div",{className:"mt-4",children:[s.variants&&s.variants.length>0&&(0,d.jsxs)("div",{className:"mb-4",children:[d.jsx("div",{className:"text-sm text-gray-600 mb-2",children:r("size")}),d.jsx("div",{className:"flex flex-wrap gap-2",children:s.variants.map(e=>d.jsx("button",{onClick:()=>y(e.name),className:`px-3 py-1.5 border rounded ${f===e.name?"border-black bg-black text-white":"bg-white"}`,children:e.name},e.id))})]}),d.jsx("ul",{className:"space-y-1 text-sm text-gray-600 list-disc pr-5",children:(s.specs||[]).map((e,t)=>d.jsx("li",{children:"string"==typeof e?e:`${e.name}: ${e.value}`},t))})]}),"reviews"===b&&(0,d.jsxs)("div",{className:"mt-4",children:[(0,d.jsxs)("div",{className:"text-sm text-gray-700 mb-3",children:["التقييم العام: ",s.averageRating," (",s.reviewCount," تقييم)"]}),(()=>{let e=(s.reviews||[]).filter(e=>!1!==e.isApproved),t=e.length||1,r=[1,2,3,4,5].reduce((t,r)=>(t[r]=e.filter(e=>e.rating===r).length,t),[]);return d.jsx("div",{className:"mb-4 space-y-1",children:[5,4,3,2,1].map(e=>{let s=r[e]||0,a=Math.round(s/t*100);return(0,d.jsxs)("div",{className:"flex items-center gap-2 text-xs",children:[(0,d.jsxs)("span",{className:"w-10",children:[e,"⭐"]}),d.jsx("div",{className:"flex-1 h-2 bg-gray-200 rounded",children:d.jsx("div",{className:"h-2 bg-[#800020] rounded",style:{width:a+"%"}})}),d.jsx("span",{className:"w-10 text-right",children:s})]},e)})})})(),(0,d.jsxs)("div",{className:"flex items-center justify-between gap-2 mb-3",children:[(0,d.jsxs)("div",{className:"flex items-center gap-1 overflow-x-auto no-scrollbar",children:[d.jsx("button",{onClick:()=>D(null),className:`px-3 py-1.5 rounded-full border ${null==_?"border-[#800020] text-[#800020]":"border-gray-200 text-gray-800"}`,children:"الكل"}),[5,4,3,2,1].map(e=>(0,d.jsxs)("button",{onClick:()=>D(e),className:`px-3 py-1.5 rounded-full border ${_===e?"border-[#800020] text-[#800020]":"border-gray-200 text-gray-800"}`,children:[e,"⭐"]},e))]}),(0,d.jsxs)("select",{value:$,onChange:e=>q(e.target.value),className:"px-3 py-1.5 rounded-full border border-gray-200 text-sm",children:[d.jsx("option",{value:"newest",children:"الأحدث"}),d.jsx("option",{value:"highest",children:"الأعلى تقييماً"}),d.jsx("option",{value:"lowest",children:"الأدنى تقييماً"})]})]}),d.jsx("ul",{className:"space-y-3",children:(t=(s.reviews||[]).filter(e=>!1!==e.isApproved),_&&(t=t.filter(e=>e.rating===_)),"newest"===$&&(t=t.sort((e,t)=>new Date(t.createdAt).getTime()-new Date(e.createdAt).getTime())),"highest"===$&&(t=t.sort((e,t)=>(t.rating||0)-(e.rating||0))),"lowest"===$&&(t=t.sort((e,t)=>(e.rating||0)-(t.rating||0))),t.slice(0,20).map(e=>(0,d.jsxs)("li",{className:"border rounded p-3",children:[(0,d.jsxs)("div",{className:"flex items-center justify-between mb-1",children:[d.jsx("div",{className:"text-sm font-semibold",children:e.user?.name||"مستخدم"}),d.jsx("div",{className:"text-xs text-gray-500",children:new Date(e.createdAt).toLocaleDateString("ar")})]}),d.jsx("div",{className:"text-[#800020] text-sm",children:"⭐".repeat(Math.max(1,Math.min(5,e.rating||0)))}),e.comment&&d.jsx("p",{className:"mt-1 text-sm text-gray-700 leading-relaxed",children:e.comment})]},e.id)))}),d.jsx("div",{className:"mt-4 border-t pt-4",children:I?(0,d.jsxs)("form",{className:"space-y-2",onSubmit:async e=>{e.preventDefault();try{await i.reviews.create.mutateAsync({productId:s.id,rating:C,comment:A}),z("")}catch{}},children:[d.jsx("div",{className:"flex items-center gap-2",children:[1,2,3,4,5].map(e=>d.jsx("button",{type:"button",onClick:()=>P(e),"aria-label":`rate-${e}`,children:e<=C?"⭐":"☆"},e))}),d.jsx("textarea",{value:A,onChange:e=>z(e.target.value),placeholder:"اكتب تعليقك",className:"w-full border rounded px-3 py-2 min-h-[84px]"}),d.jsx("button",{type:"submit",className:"px-4 py-2 bg-[#800020] text-white rounded",children:"إرسال التقييم"})]}):d.jsx("div",{className:"text-sm text-gray-600",children:"سجّل الدخول لإضافة تقييم."})})]}),(0,d.jsxs)("div",{className:"mt-6 flex items-center gap-3",children:[(0,d.jsxs)("div",{className:"flex items-center border rounded",children:[d.jsx("button",{className:"px-3 py-2",onClick:()=>g(e=>Math.max(1,e-1)),"aria-label":"decrease",children:"-"}),d.jsx("div",{className:"px-4 py-2 min-w-[48px] text-center select-none",children:x}),d.jsx("button",{className:"px-3 py-2",onClick:()=>g(e=>e+1),"aria-label":"increase",children:"+"})]}),d.jsx("button",{disabled:s.stockQuantity<=0||l.isLoading,onClick:async()=>{await l.mutateAsync({productId:s.id,quantity:x}),window.location.href="/cart"},className:"px-5 py-3 bg-[#800020] text-white rounded disabled:opacity-50",children:r("addToCart")}),d.jsx("button",{className:"px-4 py-3 border rounded",onClick:()=>window.location.href="/wishlist",children:"إضافة للمفضلة"})]}),(0,d.jsxs)("div",{className:"mt-6 space-y-2",children:[(0,d.jsxs)("div",{className:"border rounded",children:[(0,d.jsxs)("button",{className:"w-full flex items-center justify-between px-3 py-2 text-sm",onClick:()=>w(e=>!e),children:[d.jsx("span",{children:r("shipping")}),d.jsx("span",{children:j?"−":"+"})]}),j&&d.jsx("div",{className:"px-3 pb-3 text-sm text-gray-600",children:"شحن خلال 2-5 أيام عمل. تتبع فوري عند الشحن."})]}),(0,d.jsxs)("div",{className:"border rounded",children:[(0,d.jsxs)("button",{className:"w-full flex items-center justify-between px-3 py-2 text-sm",onClick:()=>E(e=>!e),children:[d.jsx("span",{children:r("returns")}),d.jsx("span",{children:S?"−":"+"})]}),S&&d.jsx("div",{className:"px-3 pb-3 text-sm text-gray-600",children:"إرجاع خلال 15 يومًا وفق الشروط."})]})]})]})]}),(0,d.jsxs)("div",{className:"md:hidden fixed bottom-0 inset-x-0 border-t bg-white p-3 flex items-center justify-between z-40",children:[(0,d.jsxs)("div",{className:"text-sm font-semibold text-[#800020]",children:["$",s.price]}),d.jsx("button",{className:"px-4 py-2 bg-[#800020] text-white rounded",onClick:async()=>{await l.mutateAsync({productId:s.id,quantity:1}),window.location.href="/cart"},children:r("addToCart")})]}),(0,d.jsxs)("section",{className:"mt-12",children:[d.jsx("h2",{className:"text-xl md:text-2xl font-bold mb-4",children:"منتجات مقترحة"}),d.jsx(k,{})]})]})}function k(){let{data:e}=c.S.products.list.useQuery({limit:10}),t=e?.items??[];return d.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 gap-4",children:t.map(e=>d.jsx(x.Il,{product:{id:e.id,name:e.name,description:e.description,price:e.price,images:e.images,stock:e.stockQuantity,rating:e.averageRating||0,reviewCount:e.reviewCount||0},onViewDetails:e=>window.location.href=`/products/${e}`},e.id))})}},7933:(e,t,r)=>{"use strict";/**
 * @license React
 * use-sync-external-store-shim/with-selector.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var s=r(4051),a=r(5643),n="function"==typeof Object.is?Object.is:function(e,t){return e===t&&(0!==e||1/e==1/t)||e!=e&&t!=t},i=a.useSyncExternalStore,l=s.useRef,o=s.useEffect,d=s.useMemo,c=s.useDebugValue;t.useSyncExternalStoreWithSelector=function(e,t,r,s,a){var u=l(null);if(null===u.current){var m={hasValue:!1,value:null};u.current=m}else m=u.current;var p=i(e,(u=d(function(){function e(e){if(!o){if(o=!0,i=e,e=s(e),void 0!==a&&m.hasValue){var t=m.value;if(a(t,e))return l=t}return l=e}if(t=l,n(i,e))return t;var r=s(e);return void 0!==a&&a(t,r)?t:(i=e,l=r)}var i,l,o=!1,d=void 0===r?null:r;return[function(){return e(t())},null===d?void 0:function(){return e(d())}]},[t,r,s,a]))[0],u[1]);return o(function(){m.hasValue=!0,m.value=p},[p]),c(p),p}},1635:(e,t,r)=>{"use strict";e.exports=r(7933)},8671:(e,t,r)=>{"use strict";r.r(t),r.d(t,{$$typeof:()=>i,__esModule:()=>n,default:()=>l});var s=r(9805);let a=(0,s.createProxy)(String.raw`/workspace/apps/web/src/app/products/[id]/page.tsx`),{__esModule:n,$$typeof:i}=a;a.default;let l=(0,s.createProxy)(String.raw`/workspace/apps/web/src/app/products/[id]/page.tsx#default`)}};var t=require("../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[638,582,192,558,533],()=>r(1962));module.exports=s})();