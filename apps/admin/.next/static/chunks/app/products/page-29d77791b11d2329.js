(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[286],{8044:function(e,t,i){Promise.resolve().then(i.bind(i,3802))},3802:function(e,t,i){"use strict";i.r(t),i.d(t,{default:function(){return o},dynamic:function(){return r}});var n=i(875),d=i(1696),a=i(5393),s=i(5009);let r="force-dynamic";function o(){var e;let[t,i]=a.useState([]),[r,o]=a.useState(1),[c]=a.useState(20),[l,u]=a.useState(""),[h,p]=a.useState(""),[x,g]=a.useState(""),[b,y]=a.useState({}),[m,f]=a.useState(0),j=d.S,v=a.useMemo(()=>s.env.NEXT_PUBLIC_API_BASE_URL||window.location.origin.replace("jeeey-manger","jeeeyai"),[]),S=a.useCallback(()=>{if("undefined"==typeof document)return{};let e=document.cookie.match(/(?:^|; )auth_token=([^;]+)/);return e?{Authorization:"Bearer ".concat(decodeURIComponent(e[1]))}:{}},[]);async function k(){var e;let t=new URL("".concat(v,"/api/admin/products"));t.searchParams.set("page",String(r)),t.searchParams.set("limit",String(c)),l&&t.searchParams.set("search",l),h&&t.searchParams.set("status",h),x&&t.searchParams.set("categoryId",x);let n=await (await fetch(t.toString(),{credentials:"include",cache:"no-store",headers:{...S()}})).json();i(n.products||[]),f((null===(e=n.pagination)||void 0===e?void 0:e.total)||0)}a.useEffect(()=>{k()},[r,h,x,v]);let w=j.admin.createProduct.useMutation();"function"==typeof(null===(e=j.admin.createProductVariants)||void 0===e?void 0:e.useMutation)&&j.admin.createProductVariants.useMutation();let[B,C]=a.useState("simple"),[E,P]=a.useState(""),[R,A]=a.useState(""),[_,I]=a.useState(""),[N,O]=a.useState(""),[U,D]=a.useState(""),[M,T]=a.useState("");j.admin.getCategories.useQuery();let[z,L]=a.useState(""),[Q,V]=a.useState(""),[H,J]=a.useState(""),[X,q]=a.useState(""),[F,K]=a.useState(""),[W,Z]=a.useState(""),[G,Y]=a.useState([]),[$,ee]=a.useState(!1),[et,ei]=a.useState("sizes_x_colors"),[en,ed]=a.useState([]),[ea,es]=a.useState([]),[er,eo]=a.useState([]),[ec,el]=a.useState([]),[eu,eh]=a.useState([]),[ep,ex]=a.useState([]),[eg,eb]=a.useState([]),[ey,em]=a.useState("");a.useEffect(()=>{(async()=>{try{let[e,t,i]=await Promise.all([fetch("".concat(v,"/api/admin/attributes/colors"),{credentials:"include",headers:{...S()}}),fetch("".concat(v,"/api/admin/attributes/brands"),{credentials:"include",headers:{...S()}}),fetch("".concat(v,"/api/admin/attributes/size-types"),{credentials:"include",headers:{...S()}})]),[n,d,a]=await Promise.all([e.json(),t.json(),i.json()]);es(n.colors||[]),eo(d.brands||[]),el(a.types||[])}catch(e){}})()},[v]),a.useEffect(()=>{(async()=>{if(!ey){eh([]);return}try{let e=await fetch("".concat(v,"/api/admin/attributes/size-types/").concat(ey,"/sizes"),{credentials:"include",headers:{...S()}}),t=await e.json();eh(t.sizes||[])}catch(e){}})()},[ey,v]),a.useEffect(()=>{V(ep.join(", "))},[ep]),a.useEffect(()=>{L(eg.join(", "))},[eg]),a.useEffect(()=>{var e;let t=(null==w?void 0:null===(e=w.error)||void 0===e?void 0:e.message)||"";t&&(/No token provided/i.test(t)||/UNAUTHORIZED/i.test(t)||/Not authenticated/i.test(t))&&(window.location.href="/login")},[w.error]);let ef=Math.max(1,Math.ceil(m/c));return(0,n.jsxs)("main",{style:{padding:24},children:[(0,n.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:16},children:[(0,n.jsx)("h1",{children:"إدارة المنتجات"}),(0,n.jsx)("a",{href:"/products/new",style:{padding:"8px 12px",background:"#800020",color:"#fff",borderRadius:8,textDecoration:"none"},children:"Add Product"})]}),(0,n.jsxs)("div",{style:{display:"flex",gap:8,marginBottom:12},children:[(0,n.jsx)("input",{value:l,onChange:e=>u(e.target.value),placeholder:"بحث بالاسم/sku",style:{padding:8,borderRadius:8,background:"#0b0e14",border:"1px solid #1c2333",color:"#e2e8f0"}}),(0,n.jsx)("button",{onClick:()=>{o(1),k()},style:{padding:"8px 12px",background:"#111827",color:"#e5e7eb",borderRadius:8},children:"بحث"}),(0,n.jsxs)("select",{value:h,onChange:e=>{p(e.target.value),o(1)},style:{padding:8,borderRadius:8,background:"#0b0e14",border:"1px solid #1c2333",color:"#e2e8f0"},children:[(0,n.jsx)("option",{value:"",children:"الكل"}),(0,n.jsx)("option",{value:"active",children:"نشط"}),(0,n.jsx)("option",{value:"archived",children:"مؤرشف"})]})]}),(0,n.jsxs)("table",{style:{width:"100%",borderCollapse:"collapse"},children:[(0,n.jsx)("thead",{children:(0,n.jsxs)("tr",{children:[(0,n.jsx)("th",{style:{textAlign:"right",borderBottom:"1px solid #1c2333",padding:8}}),(0,n.jsx)("th",{style:{textAlign:"right",borderBottom:"1px solid #1c2333",padding:8},children:"ID"}),(0,n.jsx)("th",{style:{textAlign:"right",borderBottom:"1px solid #1c2333",padding:8},children:"صورة"}),(0,n.jsx)("th",{style:{textAlign:"right",borderBottom:"1px solid #1c2333",padding:8},children:"الاسم"}),(0,n.jsx)("th",{style:{textAlign:"right",borderBottom:"1px solid #1c2333",padding:8},children:"SKU/التباينات"}),(0,n.jsx)("th",{style:{textAlign:"right",borderBottom:"1px solid #1c2333",padding:8},children:"سعر البيع"}),(0,n.jsx)("th",{style:{textAlign:"right",borderBottom:"1px solid #1c2333",padding:8},children:"إجمالي المخزون"}),(0,n.jsx)("th",{style:{textAlign:"right",borderBottom:"1px solid #1c2333",padding:8},children:"الحالة"}),(0,n.jsx)("th",{style:{textAlign:"right",borderBottom:"1px solid #1c2333",padding:8},children:"إجراءات"})]})}),(0,n.jsx)("tbody",{children:t.map(e=>{var t,i;let d=(e.variants||[]).reduce((e,t)=>e+(t.stockQuantity||0),0)+(e.stockQuantity||0);return(0,n.jsxs)("tr",{children:[(0,n.jsx)("td",{style:{padding:8,borderBottom:"1px solid #1c2333"},children:(0,n.jsx)("input",{type:"checkbox",checked:!!b[e.id],onChange:()=>y(t=>({...t,[e.id]:!t[e.id]}))})}),(0,n.jsx)("td",{style:{padding:8,borderBottom:"1px solid #1c2333"},children:e.id.slice(0,6)}),(0,n.jsx)("td",{style:{padding:8,borderBottom:"1px solid #1c2333"},children:(null===(t=e.images)||void 0===t?void 0:t[0])?(0,n.jsx)("img",{src:e.images[0],alt:e.name,style:{width:40,height:40,objectFit:"cover",borderRadius:6}}):"-"}),(0,n.jsx)("td",{style:{padding:8,borderBottom:"1px solid #1c2333"},children:e.name}),(0,n.jsx)("td",{style:{padding:8,borderBottom:"1px solid #1c2333"},children:e.sku||((null===(i=e.variants)||void 0===i?void 0:i.length)?"".concat(e.variants.length," variants"):"-")}),(0,n.jsx)("td",{style:{padding:8,borderBottom:"1px solid #1c2333"},children:e.price}),(0,n.jsx)("td",{style:{padding:8,borderBottom:"1px solid #1c2333"},children:d}),(0,n.jsx)("td",{style:{padding:8,borderBottom:"1px solid #1c2333"},children:e.isActive?"active":"archived"}),(0,n.jsxs)("td",{style:{padding:8,borderBottom:"1px solid #1c2333"},children:[(0,n.jsx)("a",{href:"/products/".concat(e.id),style:{padding:"6px 10px",background:"#374151",color:"#e5e7eb",borderRadius:6,textDecoration:"none",marginInlineEnd:6},children:"View"}),(0,n.jsx)("a",{href:"/products/new?id=".concat(e.id),style:{padding:"6px 10px",background:"#111827",color:"#e5e7eb",borderRadius:6,textDecoration:"none",marginInlineEnd:6},children:"Edit"}),(0,n.jsx)("button",{onClick:async()=>{await fetch("".concat(v,"/api/admin/products/").concat(e.id),{method:"DELETE",credentials:"include"}),await k()},style:{padding:"6px 10px",background:"#7c2d12",color:"#fff",borderRadius:6},children:"Delete"})]})]},e.id)})})]}),(0,n.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginTop:12},children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("button",{onClick:async()=>{let e=Object.keys(b).filter(e=>b[e]);e.length&&(await fetch("".concat(v,"/api/admin/products/bulk"),{method:"POST",headers:{"content-type":"application/json",...S()},credentials:"include",body:JSON.stringify({ids:e,action:"archive"})}),y({}),await k())},style:{padding:"8px 12px",background:"#374151",color:"#e5e7eb",borderRadius:8,marginInlineEnd:6},children:"Archive selected"}),(0,n.jsx)("button",{onClick:async()=>{let e=Object.keys(b).filter(e=>b[e]);e.length&&(await fetch("".concat(v,"/api/admin/products/bulk"),{method:"POST",headers:{"content-type":"application/json",...S()},credentials:"include",body:JSON.stringify({ids:e,action:"delete"})}),y({}),await k())},style:{padding:"8px 12px",background:"#7c2d12",color:"#fff",borderRadius:8},children:"Delete selected"})]}),(0,n.jsxs)("div",{style:{display:"flex",gap:8},children:[(0,n.jsx)("button",{disabled:r<=1,onClick:()=>o(e=>Math.max(1,e-1)),style:{padding:"6px 10px",background:"#111827",color:"#e5e7eb",borderRadius:6},children:"السابق"}),(0,n.jsxs)("span",{style:{color:"#9ca3af"},children:[r," / ",ef]}),(0,n.jsx)("button",{disabled:r>=ef,onClick:()=>o(e=>Math.min(ef,e+1)),style:{padding:"6px 10px",background:"#111827",color:"#e5e7eb",borderRadius:6},children:"التالي"})]})]})]})}},1696:function(e,t,i){"use strict";i.d(t,{AppProviders:function(){return u},S:function(){return l}});var n=i(875),d=i(1151),a=i(6619),s=i(1558),r=i(8028),o=i(5393),c=i(5009);let l=(0,r.ec)();function u(e){let{children:t}=e,[i]=o.useState(()=>new d.S),[r]=o.useState(()=>{let e=c.env.NEXT_PUBLIC_TRPC_URL;return e||(e=window.location.hostname.endsWith("onrender.com")?"https://jeeeyai.onrender.com/trpc":"http://localhost:4000/trpc"),l.createClient({links:[(0,s.N8)({url:e,fetch:(e,t)=>fetch(e,{...null!=t?t:{},credentials:"include"})})]})});return(0,n.jsx)(l.Provider,{client:r,queryClient:i,children:(0,n.jsx)(a.aH,{client:i,children:t})})}}},function(e){e.O(0,[722,64,694,744],function(){return e(e.s=8044)}),_N_E=e.O()}]);