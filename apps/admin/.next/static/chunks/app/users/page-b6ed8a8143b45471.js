(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[240],{8933:function(e,t,n){Promise.resolve().then(n.bind(n,6557))},6557:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return d},dynamic:function(){return o}});var r=n(875),s=n(5393);function i(e){let{apiBase:t,authHeaders:n}=e,[i,a]=s.useState([]),[o,d]=s.useState([]),[l,c]=s.useState(""),[u,p]=s.useState(""),[h,g]=s.useState(""),[x,b]=s.useState(""),[m,f]=s.useState([]),[y,j]=s.useState({});async function v(){let[e,r]=await Promise.all([fetch("".concat(t,"/api/admin/roles"),{credentials:"include",headers:{...n()},cache:"no-store"}).then(e=>e.json()).catch(()=>({roles:[]})),fetch("".concat(t,"/api/admin/permissions"),{credentials:"include",headers:{...n()},cache:"no-store"}).then(e=>e.json()).catch(()=>({permissions:[]}))]);a(e.roles||[]),d(r.permissions||[])}async function k(){l.trim()&&(await fetch("".concat(t,"/api/admin/roles"),{method:"POST",headers:{"content-type":"application/json",...n()},credentials:"include",body:JSON.stringify({name:l.trim()})}),c(""),await v())}async function w(e,r){await fetch("".concat(t,"/api/admin/roles/").concat(e,"/permissions"),{method:"POST",headers:{"content-type":"application/json",...n()},credentials:"include",body:JSON.stringify({permissionIds:r})}),await v()}async function C(){let e=new URL("".concat(t,"/api/admin/users/list"));e.searchParams.set("page","1"),e.searchParams.set("limit","50"),x&&e.searchParams.set("search",x),f((await (await fetch(e.toString(),{credentials:"include",headers:{...n()},cache:"no-store"})).json()).users||[]),j({})}async function S(){if(h)for(let e of Object.entries(y).filter(e=>{let[,t]=e;return t}).map(e=>{let[t]=e;return t}))await fetch("".concat(t,"/api/admin/users/").concat(e,"/assign-roles"),{method:"POST",headers:{"content-type":"application/json",...n()},credentials:"include",body:JSON.stringify({roleIds:[h]})})}s.useEffect(()=>{v()},[t]);let R=s.useMemo(()=>o.filter(e=>!u||e.key.toLowerCase().includes(u.toLowerCase())),[o,u]),T=s.useMemo(()=>i.find(e=>e.id===h),[i,h]),N=new Set(((null==T?void 0:T.permissions)||[]).map(e=>e.id));return(0,r.jsxs)("section",{className:"panel",style:{marginTop:16},children:[(0,r.jsx)("h3",{style:{marginTop:0},children:"إدارة الصلاحيات"}),(0,r.jsxs)("div",{className:"grid",style:{gridTemplateColumns:"1fr 2fr",gap:16},children:[(0,r.jsxs)("div",{children:[(0,r.jsxs)("div",{className:"grid",style:{gridTemplateColumns:"1fr auto",gap:8,marginBottom:8},children:[(0,r.jsx)("input",{className:"input",placeholder:"اسم الدور",value:l,onChange:e=>c(e.target.value)}),(0,r.jsx)("button",{className:"btn",onClick:k,children:"إضافة دور"})]}),(0,r.jsx)("div",{style:{maxHeight:300,overflow:"auto"},children:i.map(e=>(0,r.jsx)("div",{onClick:()=>g(e.id),style:{padding:10,border:"1px solid var(--muted)",borderRadius:8,marginBottom:8,background:h===e.id?"#101828":"transparent",cursor:"pointer"},children:e.name},e.id))})]}),(0,r.jsxs)("div",{children:[(0,r.jsxs)("div",{className:"grid",style:{gridTemplateColumns:"1fr auto",gap:8,marginBottom:8},children:[(0,r.jsx)("input",{className:"input",placeholder:"بحث صلاحيات",value:u,onChange:e=>p(e.target.value)}),(0,r.jsx)("button",{className:"icon-btn",onClick:()=>p(""),children:"مسح"})]}),(0,r.jsx)("div",{style:{maxHeight:320,overflow:"auto",border:"1px solid var(--muted)",borderRadius:8,padding:8},children:R.map(e=>{let t=N.has(e.id);return(0,r.jsxs)("label",{style:{display:"flex",alignItems:"center",gap:8,padding:"6px 4px"},children:[(0,r.jsx)("input",{type:"checkbox",checked:t,onChange:t=>{let n=new Set(N);t.target.checked?n.add(e.id):n.delete(e.id),w(h,Array.from(n))}}),(0,r.jsx)("span",{children:e.key})]},e.id)})}),(0,r.jsxs)("div",{style:{marginTop:12},children:[(0,r.jsx)("div",{style:{color:"var(--sub)",marginBottom:6},children:"إسناد الدور للمستخدمين"}),(0,r.jsxs)("div",{className:"grid",style:{gridTemplateColumns:"1fr auto",gap:8,marginBottom:8},children:[(0,r.jsx)("input",{className:"input",placeholder:"بحث مستخدمين",value:x,onChange:e=>b(e.target.value)}),(0,r.jsx)("button",{className:"btn",onClick:C,children:"بحث"})]}),(0,r.jsx)("div",{style:{maxHeight:220,overflow:"auto",border:"1px solid var(--muted)",borderRadius:8},children:m.map(e=>(0,r.jsxs)("label",{style:{display:"flex",alignItems:"center",gap:8,padding:"6px 8px"},children:[(0,r.jsx)("input",{type:"checkbox",checked:!!y[e.id],onChange:()=>j(t=>({...t,[e.id]:!t[e.id]}))}),(0,r.jsxs)("span",{children:[e.name||"-"," — ",e.email]})]},e.id))}),(0,r.jsx)("div",{style:{display:"flex",justifyContent:"flex-end",marginTop:8},children:(0,r.jsx)("button",{className:"btn",onClick:S,children:"إسناد الدور للمختارين"})})]})]})]})]})}var a=n(5009);let o="force-dynamic";function d(){let e=s.useMemo(()=>a.env.NEXT_PUBLIC_API_BASE_URL||window.location.origin.replace("jeeey-manger","jeeeyai"),[]),t=s.useCallback(()=>{if("undefined"==typeof document)return{};let e=document.cookie.match(/(?:^|; )auth_token=([^;]+)/);return e?{Authorization:"Bearer ".concat(decodeURIComponent(e[1]))}:{}},[]),[n,o]=s.useState(1),[d,u]=s.useState(""),[p,h]=s.useState([]),[g,x]=s.useState("MANAGER"),[b,m]=s.useState({}),[f,y]=s.useState("users"),[j,v]=s.useState(!1),[k,w]=s.useState(""),C=e=>{w(e),setTimeout(()=>w(""),1800)};async function S(){let r=new URL("".concat(e,"/api/admin/users/list"));r.searchParams.set("page",String(n)),r.searchParams.set("limit","20"),d&&r.searchParams.set("search",d),"admins"===f?r.searchParams.set("role","ADMIN"):"users"===f?r.searchParams.set("role","USER"):"vendors"===f&&r.searchParams.set("role","VENDOR");let s=await fetch(r.toString(),{credentials:"include",headers:{...t()},cache:"no-store"});h((await s.json()).users||[])}async function R(n){await fetch("".concat(e,"/api/admin/users/assign-role"),{method:"POST",headers:{"content-type":"application/json",...t()},credentials:"include",body:JSON.stringify({userId:n,roleName:g})}),await S()}async function T(){for(let e of p.filter(e=>b[e.id]).map(e=>e.id))await R(e)}return s.useEffect(()=>{S()},[n,e,f,d]),(0,r.jsxs)("main",{style:{padding:16},children:[k&&(0,r.jsx)("div",{style:{marginBottom:8,background:"#111827",color:"#e5e7eb",padding:"6px 10px",borderRadius:8},children:k}),(0,r.jsxs)("div",{style:{display:"flex",justifyContent:"center",gap:8,marginBottom:12},children:[(0,r.jsx)("button",{onClick:()=>{y("users"),o(1),S()},style:{padding:"8px 14px",borderRadius:999,background:"users"===f?"#800020":"#111827",color:"#e5e7eb",border:"1px solid #1c2333"},children:"المستخدمون"}),(0,r.jsx)("button",{onClick:()=>{y("vendors"),o(1),S()},style:{padding:"8px 14px",borderRadius:999,background:"vendors"===f?"#800020":"#111827",color:"#e5e7eb",border:"1px solid #1c2333"},children:"المورّدون"}),(0,r.jsx)("button",{onClick:()=>{y("admins"),o(1),S()},style:{padding:"8px 14px",borderRadius:999,background:"admins"===f?"#800020":"#111827",color:"#e5e7eb",border:"1px solid #1c2333"},children:"الإدارة"}),(0,r.jsx)("button",{onClick:()=>{y("permissions")},style:{padding:"8px 14px",borderRadius:999,background:"permissions"===f?"#800020":"#111827",color:"#e5e7eb",border:"1px solid #1c2333"},children:"الصلاحيات"})]}),"permissions"!==f&&(0,r.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:12},children:[(0,r.jsxs)("div",{style:{display:"flex",gap:8},children:[(0,r.jsx)("input",{value:d,onChange:e=>u(e.target.value),placeholder:"بحث بالاسم/البريد/الهاتف",style:{padding:8,borderRadius:8,background:"#0b0e14",border:"1px solid #1c2333",color:"#e2e8f0"}}),(0,r.jsx)("button",{onClick:()=>{o(1),S()},style:{padding:"8px 12px",background:"#111827",color:"#e5e7eb",borderRadius:8},children:"بحث"})]}),(0,r.jsx)("button",{onClick:()=>v(!0),style:{padding:"8px 12px",background:"#800020",color:"#fff",borderRadius:8},children:"إضافة حساب"})]}),"permissions"!==f&&(0,r.jsx)("div",{style:{display:"flex",gap:8,marginBottom:12},children:(0,r.jsxs)("select",{value:g,onChange:e=>x(e.target.value),style:{padding:8,borderRadius:8,background:"#0b0e14",border:"1px solid #1c2333",color:"#e2e8f0"},children:[(0,r.jsx)("option",{value:"MANAGER",children:"MANAGER"}),(0,r.jsx)("option",{value:"OPERATOR",children:"OPERATOR"}),(0,r.jsx)("option",{value:"ADMIN",children:"ADMIN"})]})}),"permissions"!==f&&(0,r.jsxs)("table",{style:{width:"100%",borderCollapse:"separate",borderSpacing:0},children:[(0,r.jsx)("thead",{children:(0,r.jsxs)("tr",{children:[(0,r.jsx)("th",{style:{textAlign:"right",borderBottom:"1px solid #1c2333",padding:12,background:"#0f1320"}}),(0,r.jsx)("th",{style:{textAlign:"right",borderBottom:"1px solid #1c2333",padding:12,background:"#0f1320"},children:"البريد"}),(0,r.jsx)("th",{style:{textAlign:"right",borderBottom:"1px solid #1c2333",padding:12,background:"#0f1320"},children:"الاسم"}),(0,r.jsx)("th",{style:{textAlign:"right",borderBottom:"1px solid #1c2333",padding:12,background:"#0f1320"},children:"الهاتف"}),(0,r.jsx)("th",{style:{textAlign:"right",borderBottom:"1px solid #1c2333",padding:12,background:"#0f1320"},children:"الدور"}),(0,r.jsx)("th",{style:{textAlign:"right",borderBottom:"1px solid #1c2333",padding:12,background:"#0f1320"},children:"إجراءات"})]})}),(0,r.jsx)("tbody",{children:p.map(e=>(0,r.jsxs)("tr",{children:[(0,r.jsx)("td",{style:{padding:12,borderBottom:"1px solid #1c2333"},children:(0,r.jsx)("input",{type:"checkbox",checked:!!b[e.id],onChange:()=>m(t=>({...t,[e.id]:!t[e.id]}))})}),(0,r.jsx)("td",{style:{padding:12,borderBottom:"1px solid #1c2333"},children:e.email}),(0,r.jsx)("td",{style:{padding:12,borderBottom:"1px solid #1c2333"},children:e.name}),(0,r.jsx)("td",{style:{padding:12,borderBottom:"1px solid #1c2333"},children:e.phone||"-"}),(0,r.jsx)("td",{style:{padding:12,borderBottom:"1px solid #1c2333"},children:e.role}),(0,r.jsx)("td",{style:{padding:12,borderBottom:"1px solid #1c2333"},children:(0,r.jsxs)("button",{onClick:()=>R(e.id),style:{padding:"6px 10px",background:"#111827",color:"#e5e7eb",borderRadius:6},children:["إسناد ",g]})})]},e.id))})]}),"permissions"!==f&&(0,r.jsx)("div",{style:{marginTop:12},children:(0,r.jsx)("button",{onClick:T,style:{padding:"8px 12px",background:"#064e3b",color:"#e5e7eb",borderRadius:8},children:"إسناد جماعي"})}),"permissions"===f&&(0,r.jsx)(i,{apiBase:e,authHeaders:t}),j&&(0,r.jsx)("div",{style:{position:"fixed",inset:0,background:"rgba(0,0,0,0.5)",display:"grid",placeItems:"center",zIndex:50},children:(0,r.jsxs)("div",{style:{width:520,background:"#0f1420",border:"1px solid #1c2333",borderRadius:12,padding:16},children:[(0,r.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:8},children:[(0,r.jsx)("h3",{style:{margin:0},children:"إضافة حساب"}),(0,r.jsx)("button",{onClick:()=>v(!1),style:{padding:"6px 10px",background:"#111827",color:"#e5e7eb",borderRadius:6},children:"إغلاق"})]}),"vendors"===f?(0,r.jsx)(c,{onDone:async()=>{v(!1),C("تمت الإضافة"),await S()},apiBase:e,authHeaders:t}):(0,r.jsx)(l,{role:"admins"===f?"ADMIN":"USER",onDone:async()=>{v(!1),C("تمت الإضافة"),await S()},apiBase:e,authHeaders:t})]})})]})}function l(e){let{role:t,onDone:n,apiBase:i,authHeaders:a}=e,[o,d]=s.useState(""),[l,c]=s.useState(""),[u,p]=s.useState(""),[h,g]=s.useState(""),[x,b]=s.useState(""),[m,f]=s.useState(""),[y,j]=s.useState(""),[v,k]=s.useState(!1),[w,C]=s.useState(""),S=s.useMemo(()=>[{value:"USER",label:"USER"},{value:"ADMIN",label:"ADMIN"}].filter(e=>!y||e.label.toLowerCase().includes(y.toLowerCase())),[y]);async function R(e){if(e.preventDefault(),!v){k(!0),C("");try{let e=await fetch("".concat(i,"/api/admin/users"),{method:"POST",headers:{"content-type":"application/json",...a()},credentials:"include",body:JSON.stringify({name:o,phone:l,role:t,email:u,username:h,address:x,password:m})});if(!e.ok){let t="تعذّر إنشاء الحساب";try{let n=await e.json();(null==n?void 0:n.error)==="required_fields"?t="الحقول المطلوبة مفقودة (كلمة السر + بريد/اسم مستخدم/هاتف)":(null==n?void 0:n.message)&&(t=n.message)}catch(e){}C(t);return}d(""),c(""),p(""),g(""),b(""),f(""),await n()}finally{k(!1)}}}return(0,r.jsxs)("form",{onSubmit:R,style:{display:"grid",gap:10},children:[w&&(0,r.jsx)("div",{style:{background:"#7f1d1d",color:"#fee2e2",padding:"8px 10px",borderRadius:8},children:w}),(0,r.jsxs)("label",{children:["الاسم",(0,r.jsx)("input",{value:o,onChange:e=>d(e.target.value),style:{width:"100%",padding:10,borderRadius:8,background:"#0b0e14",border:"1px solid #1c2333",color:"#e2e8f0"}})]}),(0,r.jsxs)("label",{children:["رقم الهاتف",(0,r.jsx)("input",{value:l,onChange:e=>c(e.target.value),style:{width:"100%",padding:10,borderRadius:8,background:"#0b0e14",border:"1px solid #1c2333",color:"#e2e8f0"}})]}),(0,r.jsxs)("label",{children:["البريد أو اسم المستخدم",(0,r.jsx)("input",{autoComplete:"username email",value:u||h,onChange:e=>{p(e.target.value),g(e.target.value)},style:{width:"100%",padding:10,borderRadius:8,background:"#0b0e14",border:"1px solid #1c2333",color:"#e2e8f0"}})]}),(0,r.jsxs)("label",{children:["العنوان (الموقع داخل المدينة)",(0,r.jsx)("input",{autoComplete:"street-address",value:x,onChange:e=>b(e.target.value),style:{width:"100%",padding:10,borderRadius:8,background:"#0b0e14",border:"1px solid #1c2333",color:"#e2e8f0"}})]}),(0,r.jsxs)("label",{children:["كلمة السر",(0,r.jsx)("input",{autoComplete:"new-password",type:"password",value:m,onChange:e=>f(e.target.value),style:{width:"100%",padding:10,borderRadius:8,background:"#0b0e14",border:"1px solid #1c2333",color:"#e2e8f0"}})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("div",{style:{marginBottom:6,color:"#9ca3af"},children:"نوع الحساب"}),(0,r.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"1fr 200px",gap:8},children:[(0,r.jsx)("select",{value:t,onChange:e=>{},disabled:!0,style:{padding:10,borderRadius:8,background:"#0b0e14",border:"1px solid #1c2333",color:"#e2e8f0"},children:S.map(e=>(0,r.jsx)("option",{value:e.value,children:e.label},e.value))}),(0,r.jsx)("input",{placeholder:"بحث نوع الحساب",value:y,onChange:e=>j(e.target.value),style:{padding:10,borderRadius:8,background:"#0b0e14",border:"1px solid #1c2333",color:"#e2e8f0"}})]})]}),(0,r.jsx)("div",{style:{display:"flex",justifyContent:"flex-end",gap:8},children:(0,r.jsx)("button",{type:"submit",disabled:v,style:{padding:"8px 12px",background:v?"#4b5563":"#800020",color:"#fff",borderRadius:8},children:v?"جارٍ الإضافة...":"إضافة"})})]})}function c(e){let{onDone:t,apiBase:n,authHeaders:i}=e,[a,o]=s.useState(""),[d,l]=s.useState(""),[c,u]=s.useState(""),[p,h]=s.useState([]),[g,x]=s.useState(!1),[b,m]=s.useState("");async function f(e){if(e.preventDefault(),g)return;x(!0),m("");let r={password:d,vendorId:c};/@/.test(a)?r.email=a:/^\+?\d/.test(a)?r.phone=a:r.username=a;try{if(!r.vendorId){m("اختر مورّداً");return}if(!r.password||!(r.email||r.username||r.phone)){m("الحقول المطلوبة مفقودة (كلمة السر + معرف)");return}let e=await fetch("".concat(n,"/api/admin/users"),{method:"POST",headers:{"content-type":"application/json",...i()},credentials:"include",body:JSON.stringify(r)});if(!e.ok){let t="تعذّر إنشاء الحساب للمورّد";try{let n=await e.json();(null==n?void 0:n.error)==="required_fields"?t="الحقول المطلوبة مفقودة (كلمة السر + معرف)":(null==n?void 0:n.message)&&(t=n.message)}catch(e){}m(t);return}o(""),l(""),u(""),await t()}finally{x(!1)}}return s.useEffect(()=>{(async()=>{try{let e=await (await fetch("".concat(n,"/api/admin/vendors/list"),{credentials:"include",headers:{...i()}})).json();h(e.vendors||[])}catch(e){}})()},[n]),(0,r.jsxs)("form",{onSubmit:f,style:{display:"grid",gap:10},children:[b&&(0,r.jsx)("div",{style:{background:"#7f1d1d",color:"#fee2e2",padding:"8px 10px",borderRadius:8},children:b}),(0,r.jsxs)("label",{children:["المستخدم/الهاتف",(0,r.jsx)("input",{value:a,onChange:e=>o(e.target.value),style:{width:"100%",padding:10,borderRadius:8,background:"#0b0e14",border:"1px solid #1c2333",color:"#e2e8f0"}})]}),(0,r.jsxs)("label",{children:["كلمة السر",(0,r.jsx)("input",{autoComplete:"new-password",type:"password",value:d,onChange:e=>l(e.target.value),style:{width:"100%",padding:10,borderRadius:8,background:"#0b0e14",border:"1px solid #1c2333",color:"#e2e8f0"}})]}),(0,r.jsxs)("label",{children:["المورّد",(0,r.jsxs)("select",{value:c,onChange:e=>u(e.target.value),style:{width:"100%",padding:10,borderRadius:8,background:"#0b0e14",border:"1px solid #1c2333",color:"#e2e8f0"},children:[(0,r.jsx)("option",{value:"",children:"اختر مورّداً"}),p.map(e=>(0,r.jsx)("option",{value:e.id,children:e.name},e.id))]})]}),(0,r.jsx)("div",{style:{display:"flex",justifyContent:"flex-end",gap:8},children:(0,r.jsx)("button",{type:"submit",disabled:g,style:{padding:"8px 12px",background:g?"#4b5563":"#800020",color:"#fff",borderRadius:8},children:g?"جارٍ الإضافة...":"إضافة"})})]})}},5009:function(e,t,n){"use strict";var r,s;e.exports=(null==(r=n.g.process)?void 0:r.env)&&"object"==typeof(null==(s=n.g.process)?void 0:s.env)?n.g.process:n(4634)},4634:function(e){!function(){var t={229:function(e){var t,n,r,s=e.exports={};function i(){throw Error("setTimeout has not been defined")}function a(){throw Error("clearTimeout has not been defined")}function o(e){if(t===setTimeout)return setTimeout(e,0);if((t===i||!t)&&setTimeout)return t=setTimeout,setTimeout(e,0);try{return t(e,0)}catch(n){try{return t.call(null,e,0)}catch(n){return t.call(this,e,0)}}}!function(){try{t="function"==typeof setTimeout?setTimeout:i}catch(e){t=i}try{n="function"==typeof clearTimeout?clearTimeout:a}catch(e){n=a}}();var d=[],l=!1,c=-1;function u(){l&&r&&(l=!1,r.length?d=r.concat(d):c=-1,d.length&&p())}function p(){if(!l){var e=o(u);l=!0;for(var t=d.length;t;){for(r=d,d=[];++c<t;)r&&r[c].run();c=-1,t=d.length}r=null,l=!1,function(e){if(n===clearTimeout)return clearTimeout(e);if((n===a||!n)&&clearTimeout)return n=clearTimeout,clearTimeout(e);try{n(e)}catch(t){try{return n.call(null,e)}catch(t){return n.call(this,e)}}}(e)}}function h(e,t){this.fun=e,this.array=t}function g(){}s.nextTick=function(e){var t=Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];d.push(new h(e,t)),1!==d.length||l||o(p)},h.prototype.run=function(){this.fun.apply(null,this.array)},s.title="browser",s.browser=!0,s.env={},s.argv=[],s.version="",s.versions={},s.on=g,s.addListener=g,s.once=g,s.off=g,s.removeListener=g,s.removeAllListeners=g,s.emit=g,s.prependListener=g,s.prependOnceListener=g,s.listeners=function(e){return[]},s.binding=function(e){throw Error("process.binding is not supported")},s.cwd=function(){return"/"},s.chdir=function(e){throw Error("process.chdir is not supported")},s.umask=function(){return 0}}},n={};function r(e){var s=n[e];if(void 0!==s)return s.exports;var i=n[e]={exports:{}},a=!0;try{t[e](i,i.exports,r),a=!1}finally{a&&delete n[e]}return i.exports}r.ab="//";var s=r(229);e.exports=s}()}},function(e){e.O(0,[64,694,744],function(){return e(e.s=8933)}),_N_E=e.O()}]);