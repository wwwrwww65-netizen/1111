(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[240],{8933:function(e,t,r){Promise.resolve().then(r.bind(r,538))},538:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return s},dynamic:function(){return d}});var n=r(875),o=r(5393),i=r(5009);let d="force-dynamic";function s(){let e=o.useMemo(()=>i.env.NEXT_PUBLIC_API_BASE_URL||window.location.origin.replace("jeeey-manger","jeeeyai"),[]),t=o.useCallback(()=>{if("undefined"==typeof document)return{};let e=document.cookie.match(/(?:^|; )auth_token=([^;]+)/);return e?{Authorization:"Bearer ".concat(decodeURIComponent(e[1]))}:{}},[]),[r,d]=o.useState(1),[s,c]=o.useState(""),[u,p]=o.useState([]),[h,b]=o.useState("MANAGER"),[g,x]=o.useState({}),[f,y]=o.useState("users"),[m,j]=o.useState(!1),[v,k]=o.useState(""),w=e=>{k(e),setTimeout(()=>k(""),1800)};async function R(){let n=new URL("".concat(e,"/api/admin/users/list"));n.searchParams.set("page",String(r)),n.searchParams.set("limit","20"),s&&n.searchParams.set("search",s),"admins"===f?n.searchParams.set("role","ADMIN"):"users"===f?n.searchParams.set("role","USER"):"vendors"===f&&n.searchParams.set("role","VENDOR");let o=await fetch(n.toString(),{credentials:"include",headers:{...t()},cache:"no-store"});p((await o.json()).users||[])}async function C(r){await fetch("".concat(e,"/api/admin/users/assign-role"),{method:"POST",headers:{"content-type":"application/json",...t()},credentials:"include",body:JSON.stringify({userId:r,roleName:h})}),await R()}async function S(){for(let e of u.filter(e=>g[e.id]).map(e=>e.id))await C(e)}return o.useEffect(()=>{R()},[r,e,f,s]),(0,n.jsxs)("main",{style:{padding:16},children:[v&&(0,n.jsx)("div",{style:{marginBottom:8,background:"#111827",color:"#e5e7eb",padding:"6px 10px",borderRadius:8},children:v}),(0,n.jsxs)("div",{style:{display:"flex",justifyContent:"center",gap:8,marginBottom:12},children:[(0,n.jsx)("button",{onClick:()=>{y("users"),d(1),R()},style:{padding:"8px 14px",borderRadius:999,background:"users"===f?"#800020":"#111827",color:"#e5e7eb",border:"1px solid #1c2333"},children:"المستخدمون"}),(0,n.jsx)("button",{onClick:()=>{y("vendors"),d(1),R()},style:{padding:"8px 14px",borderRadius:999,background:"vendors"===f?"#800020":"#111827",color:"#e5e7eb",border:"1px solid #1c2333"},children:"المورّدون"}),(0,n.jsx)("button",{onClick:()=>{y("admins"),d(1),R()},style:{padding:"8px 14px",borderRadius:999,background:"admins"===f?"#800020":"#111827",color:"#e5e7eb",border:"1px solid #1c2333"},children:"الإدارة"})]}),(0,n.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:12},children:[(0,n.jsxs)("div",{style:{display:"flex",gap:8},children:[(0,n.jsx)("input",{value:s,onChange:e=>c(e.target.value),placeholder:"بحث بالاسم/البريد/الهاتف",style:{padding:8,borderRadius:8,background:"#0b0e14",border:"1px solid #1c2333",color:"#e2e8f0"}}),(0,n.jsx)("button",{onClick:()=>{d(1),R()},style:{padding:"8px 12px",background:"#111827",color:"#e5e7eb",borderRadius:8},children:"بحث"})]}),(0,n.jsx)("button",{onClick:()=>j(!0),style:{padding:"8px 12px",background:"#800020",color:"#fff",borderRadius:8},children:"إضافة حساب"})]}),(0,n.jsx)("div",{style:{display:"flex",gap:8,marginBottom:12},children:(0,n.jsxs)("select",{value:h,onChange:e=>b(e.target.value),style:{padding:8,borderRadius:8,background:"#0b0e14",border:"1px solid #1c2333",color:"#e2e8f0"},children:[(0,n.jsx)("option",{value:"MANAGER",children:"MANAGER"}),(0,n.jsx)("option",{value:"OPERATOR",children:"OPERATOR"}),(0,n.jsx)("option",{value:"ADMIN",children:"ADMIN"})]})}),(0,n.jsxs)("table",{style:{width:"100%",borderCollapse:"separate",borderSpacing:0},children:[(0,n.jsx)("thead",{children:(0,n.jsxs)("tr",{children:[(0,n.jsx)("th",{style:{textAlign:"right",borderBottom:"1px solid #1c2333",padding:12,background:"#0f1320"}}),(0,n.jsx)("th",{style:{textAlign:"right",borderBottom:"1px solid #1c2333",padding:12,background:"#0f1320"},children:"البريد"}),(0,n.jsx)("th",{style:{textAlign:"right",borderBottom:"1px solid #1c2333",padding:12,background:"#0f1320"},children:"الاسم"}),(0,n.jsx)("th",{style:{textAlign:"right",borderBottom:"1px solid #1c2333",padding:12,background:"#0f1320"},children:"الهاتف"}),(0,n.jsx)("th",{style:{textAlign:"right",borderBottom:"1px solid #1c2333",padding:12,background:"#0f1320"},children:"الدور"}),(0,n.jsx)("th",{style:{textAlign:"right",borderBottom:"1px solid #1c2333",padding:12,background:"#0f1320"},children:"إجراءات"})]})}),(0,n.jsx)("tbody",{children:u.map(e=>(0,n.jsxs)("tr",{children:[(0,n.jsx)("td",{style:{padding:12,borderBottom:"1px solid #1c2333"},children:(0,n.jsx)("input",{type:"checkbox",checked:!!g[e.id],onChange:()=>x(t=>({...t,[e.id]:!t[e.id]}))})}),(0,n.jsx)("td",{style:{padding:12,borderBottom:"1px solid #1c2333"},children:e.email}),(0,n.jsx)("td",{style:{padding:12,borderBottom:"1px solid #1c2333"},children:e.name}),(0,n.jsx)("td",{style:{padding:12,borderBottom:"1px solid #1c2333"},children:e.phone||"-"}),(0,n.jsx)("td",{style:{padding:12,borderBottom:"1px solid #1c2333"},children:e.role}),(0,n.jsx)("td",{style:{padding:12,borderBottom:"1px solid #1c2333"},children:(0,n.jsxs)("button",{onClick:()=>C(e.id),style:{padding:"6px 10px",background:"#111827",color:"#e5e7eb",borderRadius:6},children:["إسناد ",h]})})]},e.id))})]}),(0,n.jsx)("div",{style:{marginTop:12},children:(0,n.jsx)("button",{onClick:S,style:{padding:"8px 12px",background:"#064e3b",color:"#e5e7eb",borderRadius:8},children:"إسناد جماعي"})}),m&&(0,n.jsx)("div",{style:{position:"fixed",inset:0,background:"rgba(0,0,0,0.5)",display:"grid",placeItems:"center",zIndex:50},children:(0,n.jsxs)("div",{style:{width:520,background:"#0f1420",border:"1px solid #1c2333",borderRadius:12,padding:16},children:[(0,n.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:8},children:[(0,n.jsx)("h3",{style:{margin:0},children:"إضافة حساب"}),(0,n.jsx)("button",{onClick:()=>j(!1),style:{padding:"6px 10px",background:"#111827",color:"#e5e7eb",borderRadius:6},children:"إغلاق"})]}),"vendors"===f?(0,n.jsx)(l,{onDone:async()=>{j(!1),w("تمت الإضافة"),await R()},apiBase:e,authHeaders:t}):(0,n.jsx)(a,{role:"admins"===f?"ADMIN":"USER",onDone:async()=>{j(!1),w("تمت الإضافة"),await R()},apiBase:e,authHeaders:t})]})})]})}function a(e){let{role:t,onDone:r,apiBase:i,authHeaders:d}=e,[s,a]=o.useState(""),[l,c]=o.useState(""),[u,p]=o.useState(""),[h,b]=o.useState(""),[g,x]=o.useState(""),[f,y]=o.useState(""),[m,j]=o.useState(""),[v,k]=o.useState(!1),[w,R]=o.useState(""),C=o.useMemo(()=>[{value:"USER",label:"USER"},{value:"ADMIN",label:"ADMIN"}].filter(e=>!m||e.label.toLowerCase().includes(m.toLowerCase())),[m]);async function S(e){if(e.preventDefault(),!v){k(!0),R("");try{let e=await fetch("".concat(i,"/api/admin/users"),{method:"POST",headers:{"content-type":"application/json",...d()},credentials:"include",body:JSON.stringify({name:s,phone:l,role:t,email:u,username:h,address:g,password:f})});if(!e.ok){let t="تعذّر إنشاء الحساب";try{let r=await e.json();(null==r?void 0:r.error)==="required_fields"?t="الحقول المطلوبة مفقودة (كلمة السر + بريد/اسم مستخدم/هاتف)":(null==r?void 0:r.message)&&(t=r.message)}catch(e){}R(t);return}a(""),c(""),p(""),b(""),x(""),y(""),await r()}finally{k(!1)}}}return(0,n.jsxs)("form",{onSubmit:S,style:{display:"grid",gap:10},children:[w&&(0,n.jsx)("div",{style:{background:"#7f1d1d",color:"#fee2e2",padding:"8px 10px",borderRadius:8},children:w}),(0,n.jsxs)("label",{children:["الاسم",(0,n.jsx)("input",{value:s,onChange:e=>a(e.target.value),style:{width:"100%",padding:10,borderRadius:8,background:"#0b0e14",border:"1px solid #1c2333",color:"#e2e8f0"}})]}),(0,n.jsxs)("label",{children:["رقم الهاتف",(0,n.jsx)("input",{value:l,onChange:e=>c(e.target.value),style:{width:"100%",padding:10,borderRadius:8,background:"#0b0e14",border:"1px solid #1c2333",color:"#e2e8f0"}})]}),(0,n.jsxs)("label",{children:["البريد أو اسم المستخدم",(0,n.jsx)("input",{autoComplete:"username email",value:u||h,onChange:e=>{p(e.target.value),b(e.target.value)},style:{width:"100%",padding:10,borderRadius:8,background:"#0b0e14",border:"1px solid #1c2333",color:"#e2e8f0"}})]}),(0,n.jsxs)("label",{children:["العنوان (الموقع داخل المدينة)",(0,n.jsx)("input",{autoComplete:"street-address",value:g,onChange:e=>x(e.target.value),style:{width:"100%",padding:10,borderRadius:8,background:"#0b0e14",border:"1px solid #1c2333",color:"#e2e8f0"}})]}),(0,n.jsxs)("label",{children:["كلمة السر",(0,n.jsx)("input",{autoComplete:"new-password",type:"password",value:f,onChange:e=>y(e.target.value),style:{width:"100%",padding:10,borderRadius:8,background:"#0b0e14",border:"1px solid #1c2333",color:"#e2e8f0"}})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("div",{style:{marginBottom:6,color:"#9ca3af"},children:"نوع الحساب"}),(0,n.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"1fr 200px",gap:8},children:[(0,n.jsx)("select",{value:t,onChange:e=>{},disabled:!0,style:{padding:10,borderRadius:8,background:"#0b0e14",border:"1px solid #1c2333",color:"#e2e8f0"},children:C.map(e=>(0,n.jsx)("option",{value:e.value,children:e.label},e.value))}),(0,n.jsx)("input",{placeholder:"بحث نوع الحساب",value:m,onChange:e=>j(e.target.value),style:{padding:10,borderRadius:8,background:"#0b0e14",border:"1px solid #1c2333",color:"#e2e8f0"}})]})]}),(0,n.jsx)("div",{style:{display:"flex",justifyContent:"flex-end",gap:8},children:(0,n.jsx)("button",{type:"submit",disabled:v,style:{padding:"8px 12px",background:v?"#4b5563":"#800020",color:"#fff",borderRadius:8},children:v?"جارٍ الإضافة...":"إضافة"})})]})}function l(e){let{onDone:t,apiBase:r,authHeaders:i}=e,[d,s]=o.useState(""),[a,l]=o.useState(""),[c,u]=o.useState(""),[p,h]=o.useState([]),[b,g]=o.useState(!1),[x,f]=o.useState("");async function y(e){if(e.preventDefault(),b)return;g(!0),f("");let n={password:a,vendorId:c};/@/.test(d)?n.email=d:/^\+?\d/.test(d)?n.phone=d:n.username=d;try{if(!n.vendorId){f("اختر مورّداً");return}if(!n.password||!(n.email||n.username||n.phone)){f("الحقول المطلوبة مفقودة (كلمة السر + معرف)");return}let e=await fetch("".concat(r,"/api/admin/users"),{method:"POST",headers:{"content-type":"application/json",...i()},credentials:"include",body:JSON.stringify(n)});if(!e.ok){let t="تعذّر إنشاء الحساب للمورّد";try{let r=await e.json();(null==r?void 0:r.error)==="required_fields"?t="الحقول المطلوبة مفقودة (كلمة السر + معرف)":(null==r?void 0:r.message)&&(t=r.message)}catch(e){}f(t);return}s(""),l(""),u(""),await t()}finally{g(!1)}}return o.useEffect(()=>{(async()=>{try{let e=await (await fetch("".concat(r,"/api/admin/vendors/list"),{credentials:"include",headers:{...i()}})).json();h(e.vendors||[])}catch(e){}})()},[r]),(0,n.jsxs)("form",{onSubmit:y,style:{display:"grid",gap:10},children:[x&&(0,n.jsx)("div",{style:{background:"#7f1d1d",color:"#fee2e2",padding:"8px 10px",borderRadius:8},children:x}),(0,n.jsxs)("label",{children:["المستخدم/الهاتف",(0,n.jsx)("input",{value:d,onChange:e=>s(e.target.value),style:{width:"100%",padding:10,borderRadius:8,background:"#0b0e14",border:"1px solid #1c2333",color:"#e2e8f0"}})]}),(0,n.jsxs)("label",{children:["كلمة السر",(0,n.jsx)("input",{autoComplete:"new-password",type:"password",value:a,onChange:e=>l(e.target.value),style:{width:"100%",padding:10,borderRadius:8,background:"#0b0e14",border:"1px solid #1c2333",color:"#e2e8f0"}})]}),(0,n.jsxs)("label",{children:["المورّد",(0,n.jsxs)("select",{value:c,onChange:e=>u(e.target.value),style:{width:"100%",padding:10,borderRadius:8,background:"#0b0e14",border:"1px solid #1c2333",color:"#e2e8f0"},children:[(0,n.jsx)("option",{value:"",children:"اختر مورّداً"}),p.map(e=>(0,n.jsx)("option",{value:e.id,children:e.name},e.id))]})]}),(0,n.jsx)("div",{style:{display:"flex",justifyContent:"flex-end",gap:8},children:(0,n.jsx)("button",{type:"submit",disabled:b,style:{padding:"8px 12px",background:b?"#4b5563":"#800020",color:"#fff",borderRadius:8},children:b?"جارٍ الإضافة...":"إضافة"})})]})}},5009:function(e,t,r){"use strict";var n,o;e.exports=(null==(n=r.g.process)?void 0:n.env)&&"object"==typeof(null==(o=r.g.process)?void 0:o.env)?r.g.process:r(4634)},4634:function(e){!function(){var t={229:function(e){var t,r,n,o=e.exports={};function i(){throw Error("setTimeout has not been defined")}function d(){throw Error("clearTimeout has not been defined")}function s(e){if(t===setTimeout)return setTimeout(e,0);if((t===i||!t)&&setTimeout)return t=setTimeout,setTimeout(e,0);try{return t(e,0)}catch(r){try{return t.call(null,e,0)}catch(r){return t.call(this,e,0)}}}!function(){try{t="function"==typeof setTimeout?setTimeout:i}catch(e){t=i}try{r="function"==typeof clearTimeout?clearTimeout:d}catch(e){r=d}}();var a=[],l=!1,c=-1;function u(){l&&n&&(l=!1,n.length?a=n.concat(a):c=-1,a.length&&p())}function p(){if(!l){var e=s(u);l=!0;for(var t=a.length;t;){for(n=a,a=[];++c<t;)n&&n[c].run();c=-1,t=a.length}n=null,l=!1,function(e){if(r===clearTimeout)return clearTimeout(e);if((r===d||!r)&&clearTimeout)return r=clearTimeout,clearTimeout(e);try{r(e)}catch(t){try{return r.call(null,e)}catch(t){return r.call(this,e)}}}(e)}}function h(e,t){this.fun=e,this.array=t}function b(){}o.nextTick=function(e){var t=Array(arguments.length-1);if(arguments.length>1)for(var r=1;r<arguments.length;r++)t[r-1]=arguments[r];a.push(new h(e,t)),1!==a.length||l||s(p)},h.prototype.run=function(){this.fun.apply(null,this.array)},o.title="browser",o.browser=!0,o.env={},o.argv=[],o.version="",o.versions={},o.on=b,o.addListener=b,o.once=b,o.off=b,o.removeListener=b,o.removeAllListeners=b,o.emit=b,o.prependListener=b,o.prependOnceListener=b,o.listeners=function(e){return[]},o.binding=function(e){throw Error("process.binding is not supported")},o.cwd=function(){return"/"},o.chdir=function(e){throw Error("process.chdir is not supported")},o.umask=function(){return 0}}},r={};function n(e){var o=r[e];if(void 0!==o)return o.exports;var i=r[e]={exports:{}},d=!0;try{t[e](i,i.exports,n),d=!1}finally{d&&delete r[e]}return i.exports}n.ab="//";var o=n(229);e.exports=o}()}},function(e){e.O(0,[64,694,744],function(){return e(e.s=8933)}),_N_E=e.O()}]);