(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[268],{7753:function(e,t,n){Promise.resolve().then(n.bind(n,3426))},3426:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return r}});var d=n(875),i=n(5393),o=n(1696);function r(){var e;let t=o.S,[n,r]=i.useState(1),[s,c]=i.useState(""),{data:a,isLoading:u,refetch:p}=t.admin.getProducts.useQuery({page:n,limit:20,search:s}),[x,h]=i.useState({});i.useMemo(()=>t.adminAdjust||null,[t]);let b=e=>h(t=>({...t,[e]:!t[e]})),g=null!==(e=null==a?void 0:a.products)&&void 0!==e?e:[],y=g.filter(e=>x[e.id]).map(e=>e.id);async function f(e){for(let t of y)await fetch("/api/admin/inventory/adjust",{method:"POST",headers:{"content-type":"application/json"},body:JSON.stringify({productId:t,delta:e})});await p()}return u?(0,d.jsx)("main",{children:"Loading…"}):(0,d.jsxs)("main",{children:[(0,d.jsx)("h1",{style:{marginBottom:16},children:"المخزون"}),(0,d.jsxs)("div",{style:{display:"flex",gap:8,marginBottom:12},children:[(0,d.jsx)("input",{value:s,onChange:e=>c(e.target.value),placeholder:"بحث بالاسم أو SKU",style:{padding:8,borderRadius:8,background:"#0b0e14",border:"1px solid #1c2333",color:"#e2e8f0"}}),(0,d.jsx)("button",{onClick:()=>p(),style:{padding:"8px 12px",background:"#111827",color:"#e5e7eb",borderRadius:8},children:"بحث"}),(0,d.jsx)("button",{onClick:()=>f(1),disabled:!y.length,style:{padding:"8px 12px",background:"#064e3b",color:"#e5e7eb",borderRadius:8},children:"+1 للمحدد"}),(0,d.jsx)("button",{onClick:()=>f(-1),disabled:!y.length,style:{padding:"8px 12px",background:"#7c2d12",color:"#fff",borderRadius:8},children:"-1 للمحدد"}),(0,d.jsx)("button",{onClick:function(){window.open("/api/admin/inventory/export/csv","_blank")},style:{padding:"8px 12px",background:"#374151",color:"#e5e7eb",borderRadius:8},children:"تصدير CSV"}),(0,d.jsx)("button",{onClick:function(){window.open("/api/admin/inventory/export/pdf","_blank")},style:{padding:"8px 12px",background:"#1f2937",color:"#e5e7eb",borderRadius:8},children:"تصدير PDF"})]}),(0,d.jsxs)("table",{style:{width:"100%",borderCollapse:"collapse"},children:[(0,d.jsx)("thead",{children:(0,d.jsxs)("tr",{children:[(0,d.jsx)("th",{style:{textAlign:"right",borderBottom:"1px solid #1c2333",padding:8}}),(0,d.jsx)("th",{style:{textAlign:"right",borderBottom:"1px solid #1c2333",padding:8},children:"الاسم"}),(0,d.jsx)("th",{style:{textAlign:"right",borderBottom:"1px solid #1c2333",padding:8},children:"SKU"}),(0,d.jsx)("th",{style:{textAlign:"right",borderBottom:"1px solid #1c2333",padding:8},children:"المخزون"}),(0,d.jsx)("th",{style:{textAlign:"right",borderBottom:"1px solid #1c2333",padding:8},children:"تحرير"})]})}),(0,d.jsx)("tbody",{children:g.map(e=>(0,d.jsxs)("tr",{children:[(0,d.jsx)("td",{style:{padding:8,borderBottom:"1px solid #1c2333"},children:(0,d.jsx)("input",{type:"checkbox",checked:!!x[e.id],onChange:()=>b(e.id)})}),(0,d.jsx)("td",{style:{padding:8,borderBottom:"1px solid #1c2333"},children:e.name}),(0,d.jsx)("td",{style:{padding:8,borderBottom:"1px solid #1c2333"},children:e.sku||"-"}),(0,d.jsx)("td",{style:{padding:8,borderBottom:"1px solid #1c2333"},children:e.stockQuantity}),(0,d.jsx)("td",{style:{padding:8,borderBottom:"1px solid #1c2333"},children:(0,d.jsx)(l,{productId:e.id,onDone:p})})]},e.id))})]})]})}function l(e){let{productId:t,onDone:n}=e,[o,r]=i.useState("1"),[l,s]=i.useState(null);async function c(e){await fetch("/api/admin/inventory/adjust",{method:"POST",headers:{"content-type":"application/json"},body:JSON.stringify({productId:t,delta:e})}),s(-e),n()}async function a(){null!=l&&(await c(l),s(null))}return(0,d.jsxs)("div",{style:{display:"flex",gap:6,alignItems:"center"},children:[(0,d.jsx)("input",{value:o,onChange:e=>r(e.target.value),style:{width:60,padding:6,borderRadius:6,background:"#0b0e14",border:"1px solid #1c2333",color:"#e2e8f0"}}),(0,d.jsx)("button",{onClick:()=>c(Number(o)||0),style:{padding:"6px 10px",background:"#111827",color:"#e5e7eb",borderRadius:6},children:"تطبيق"}),null!=l&&(0,d.jsx)("button",{onClick:a,style:{padding:"6px 10px",background:"#7c2d12",color:"#fff",borderRadius:6},children:"تراجع"})]})}},1696:function(e,t,n){"use strict";n.d(t,{AppProviders:function(){return u},S:function(){return a}});var d=n(875),i=n(1151),o=n(6619),r=n(1558),l=n(8028),s=n(5393),c=n(5009);let a=(0,l.ec)();function u(e){let{children:t}=e,[n]=s.useState(()=>new i.S),[l]=s.useState(()=>{let e=c.env.NEXT_PUBLIC_TRPC_URL;return e||(e=window.location.hostname.endsWith("onrender.com")?"https://jeeeyai.onrender.com/trpc":"http://localhost:4000/trpc"),a.createClient({links:[(0,r.N8)({url:e,fetch:(e,t)=>fetch(e,{...null!=t?t:{},credentials:"include"})})]})});return(0,d.jsx)(a.Provider,{client:l,queryClient:n,children:(0,d.jsx)(o.aH,{client:n,children:t})})}}},function(e){e.O(0,[722,64,694,744],function(){return e(e.s=7753)}),_N_E=e.O()}]);