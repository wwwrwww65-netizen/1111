(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[268],{7753:function(e,t,n){Promise.resolve().then(n.bind(n,3426))},3426:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return l}});var o=n(875),d=n(5393),i=n(1696),r=n(5009);function l(){var e;let t=i.S,n=d.useMemo(()=>r.env.NEXT_PUBLIC_API_BASE_URL||window.location.origin.replace("jeeey-manger","jeeeyai"),[]),l=d.useCallback(()=>{if("undefined"==typeof document)return{};let e=document.cookie.match(/(?:^|; )auth_token=([^;]+)/);return e?{Authorization:"Bearer ".concat(decodeURIComponent(e[1]))}:{}},[]),[a,s]=d.useState(1),[u,p]=d.useState(""),{data:h,isLoading:x,refetch:b}=t.admin.getProducts.useQuery({page:a,limit:20,search:u}),[g,y]=d.useState({});d.useMemo(()=>t.adminAdjust||null,[t]);let m=e=>y(t=>({...t,[e]:!t[e]})),f=null!==(e=null==h?void 0:h.products)&&void 0!==e?e:[],j=f.filter(e=>g[e.id]).map(e=>e.id);async function k(e){for(let t of j)await fetch("".concat(n,"/api/admin/inventory/adjust"),{method:"POST",headers:{"content-type":"application/json",...l()},credentials:"include",body:JSON.stringify({productId:t,delta:e})});await b()}return x?(0,o.jsx)("main",{children:"Loading…"}):(0,o.jsxs)("main",{children:[(0,o.jsx)("h1",{style:{marginBottom:16},children:"المخزون"}),(0,o.jsxs)("div",{style:{display:"flex",gap:8,marginBottom:12},children:[(0,o.jsx)("input",{value:u,onChange:e=>p(e.target.value),placeholder:"بحث بالاسم أو SKU",style:{padding:8,borderRadius:8,background:"#0b0e14",border:"1px solid #1c2333",color:"#e2e8f0"}}),(0,o.jsx)("button",{onClick:()=>b(),style:{padding:"8px 12px",background:"#111827",color:"#e5e7eb",borderRadius:8},children:"بحث"}),(0,o.jsx)("button",{onClick:()=>k(1),disabled:!j.length,style:{padding:"8px 12px",background:"#064e3b",color:"#e5e7eb",borderRadius:8},children:"+1 للمحدد"}),(0,o.jsx)("button",{onClick:()=>k(-1),disabled:!j.length,style:{padding:"8px 12px",background:"#7c2d12",color:"#fff",borderRadius:8},children:"-1 للمحدد"}),(0,o.jsx)("button",{onClick:function(){window.open("".concat(n,"/api/admin/inventory/export/csv"),"_blank")},style:{padding:"8px 12px",background:"#374151",color:"#e5e7eb",borderRadius:8},children:"تصدير CSV"}),(0,o.jsx)("button",{onClick:function(){window.open("".concat(n,"/api/admin/inventory/export/pdf"),"_blank")},style:{padding:"8px 12px",background:"#1f2937",color:"#e5e7eb",borderRadius:8},children:"تصدير PDF"})]}),(0,o.jsxs)("table",{style:{width:"100%",borderCollapse:"collapse"},children:[(0,o.jsx)("thead",{children:(0,o.jsxs)("tr",{children:[(0,o.jsx)("th",{style:{textAlign:"right",borderBottom:"1px solid #1c2333",padding:8}}),(0,o.jsx)("th",{style:{textAlign:"right",borderBottom:"1px solid #1c2333",padding:8},children:"الاسم"}),(0,o.jsx)("th",{style:{textAlign:"right",borderBottom:"1px solid #1c2333",padding:8},children:"SKU"}),(0,o.jsx)("th",{style:{textAlign:"right",borderBottom:"1px solid #1c2333",padding:8},children:"المخزون"}),(0,o.jsx)("th",{style:{textAlign:"right",borderBottom:"1px solid #1c2333",padding:8},children:"تحرير"})]})}),(0,o.jsx)("tbody",{children:f.map(e=>(0,o.jsxs)("tr",{children:[(0,o.jsx)("td",{style:{padding:8,borderBottom:"1px solid #1c2333"},children:(0,o.jsx)("input",{type:"checkbox",checked:!!g[e.id],onChange:()=>m(e.id)})}),(0,o.jsx)("td",{style:{padding:8,borderBottom:"1px solid #1c2333"},children:e.name}),(0,o.jsx)("td",{style:{padding:8,borderBottom:"1px solid #1c2333"},children:e.sku||"-"}),(0,o.jsx)("td",{style:{padding:8,borderBottom:"1px solid #1c2333"},children:e.stockQuantity}),(0,o.jsx)("td",{style:{padding:8,borderBottom:"1px solid #1c2333"},children:(0,o.jsx)(c,{productId:e.id,onDone:b})})]},e.id))})]})]})}function c(e){let{productId:t,onDone:n}=e,[i,l]=d.useState("1"),[c,a]=d.useState(null),s=d.useMemo(()=>r.env.NEXT_PUBLIC_API_BASE_URL||window.location.origin.replace("jeeey-manger","jeeeyai"),[]),u=d.useCallback(()=>{if("undefined"==typeof document)return{};let e=document.cookie.match(/(?:^|; )auth_token=([^;]+)/);return e?{Authorization:"Bearer ".concat(decodeURIComponent(e[1]))}:{}},[]);async function p(e){await fetch("".concat(s,"/api/admin/inventory/adjust"),{method:"POST",headers:{"content-type":"application/json",...u()},credentials:"include",body:JSON.stringify({productId:t,delta:e})}),a(-e),n()}async function h(){null!=c&&(await p(c),a(null))}return(0,o.jsxs)("div",{style:{display:"flex",gap:6,alignItems:"center"},children:[(0,o.jsx)("input",{value:i,onChange:e=>l(e.target.value),style:{width:60,padding:6,borderRadius:6,background:"#0b0e14",border:"1px solid #1c2333",color:"#e2e8f0"}}),(0,o.jsx)("button",{onClick:()=>p(Number(i)||0),style:{padding:"6px 10px",background:"#111827",color:"#e5e7eb",borderRadius:6},children:"تطبيق"}),null!=c&&(0,o.jsx)("button",{onClick:h,style:{padding:"6px 10px",background:"#7c2d12",color:"#fff",borderRadius:6},children:"تراجع"})]})}},1696:function(e,t,n){"use strict";n.d(t,{AppProviders:function(){return u},S:function(){return s}});var o=n(875),d=n(1151),i=n(6619),r=n(1558),l=n(8028),c=n(5393),a=n(5009);let s=(0,l.ec)();function u(e){let{children:t}=e,[n]=c.useState(()=>new d.S),[l]=c.useState(()=>{let e=a.env.NEXT_PUBLIC_TRPC_URL;return e||(e=window.location.hostname.endsWith("onrender.com")?"https://jeeeyai.onrender.com/trpc":"http://localhost:4000/trpc"),s.createClient({links:[(0,r.N8)({url:e,fetch:(e,t)=>fetch(e,{...null!=t?t:{},credentials:"include"})})]})});return(0,o.jsx)(s.Provider,{client:l,queryClient:n,children:(0,o.jsx)(i.aH,{client:n,children:t})})}}},function(e){e.O(0,[722,64,694,744],function(){return e(e.s=7753)}),_N_E=e.O()}]);