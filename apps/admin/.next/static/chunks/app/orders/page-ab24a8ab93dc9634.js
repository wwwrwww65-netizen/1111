(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[569],{159:function(e,t,a){Promise.resolve().then(a.bind(a,2287))},2287:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return r}});var n=a(875),s=a(5393),i=a(5009);function r(){let[e,t]=s.useState(1),[a,r]=s.useState(20),[l,o]=s.useState(""),[d,c]=s.useState(""),[u,h]=s.useState(""),[p,m]=s.useState(""),[x,v]=s.useState(""),[g,j]=s.useState(""),[y,f]=s.useState(""),[b,N]=s.useState("createdAt"),[C,S]=s.useState("desc"),[T,w]=s.useState([]),[B,E]=s.useState(0),[I,P]=s.useState([]),[A,k]=s.useState(!1),[D,L]=s.useState(!1),[_,O]=s.useState(!1),[R,q]=s.useState(""),[M,J]=s.useState(""),[U,V]=s.useState(""),[z,F]=s.useState(""),[H,X]=s.useState([{productId:"",quantity:1}]),G=s.useMemo(()=>i.env.NEXT_PUBLIC_API_BASE_URL||window.location.origin.replace("jeeey-manger","jeeeyai"),[]),W=s.useCallback(()=>{if("undefined"==typeof document)return{};let e=document.cookie.match(/(?:^|; )auth_token=([^;]+)/);return e?{Authorization:"Bearer ".concat(decodeURIComponent(e[1]))}:{}},[]);async function K(){var t;let n=new URL("".concat(G,"/api/admin/orders/list"));n.searchParams.set("page",String(e)),n.searchParams.set("limit",String(a)),l&&n.searchParams.set("status",l),d&&n.searchParams.set("search",d),u&&n.searchParams.set("driverId",u),p&&n.searchParams.set("dateFrom",p),x&&n.searchParams.set("dateTo",x),g&&n.searchParams.set("amountMin",g),y&&n.searchParams.set("amountMax",y),b&&n.searchParams.set("sortBy",b),C&&n.searchParams.set("sortDir",C),k(!0);let s=await fetch(n.toString(),{credentials:"include",headers:{...W()},cache:"no-store"}),i=await s.json();k(!1),w(i.orders||[]),E((null===(t=i.pagination)||void 0===t?void 0:t.total)||0)}async function Q(e){await fetch("".concat(G,"/api/admin/orders/ship"),{method:"POST",headers:{"content-type":"application/json",...W()},credentials:"include",body:JSON.stringify({orderId:e})}),await K()}async function Y(e){await fetch("".concat(G,"/api/admin/payments/refund"),{method:"POST",headers:{"content-type":"application/json",...W()},credentials:"include",body:JSON.stringify({orderId:e})}),await K()}async function Z(e,t){await fetch("".concat(G,"/api/admin/orders/assign-driver"),{method:"POST",headers:{"content-type":"application/json",...W()},credentials:"include",body:JSON.stringify({orderId:e,driverId:t})}),await K()}return s.useEffect(()=>{K()},[e,a,b,C]),s.useEffect(()=>{(async()=>{try{let e=await (await fetch("".concat(G,"/api/admin/drivers"),{credentials:"include",headers:{...W()}})).json();P(e.drivers||[])}catch(e){}})()},[G]),(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)("main",{className:"panel",children:[(0,n.jsx)("h1",{style:{marginBottom:16},children:"الطلبات"}),(0,n.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:12},children:[(0,n.jsx)("div",{}),(0,n.jsxs)("div",{style:{display:"flex",gap:8},children:[(0,n.jsx)("a",{className:"btn",href:"".concat(G,"/api/admin/orders/export/csv"),children:"تصدير CSV"}),(0,n.jsx)("button",{className:"btn",onClick:()=>L(!0),children:"إنشاء طلب"})]})]}),(0,n.jsxs)("div",{className:"grid",style:{gridTemplateColumns:"repeat(6,1fr)",gap:8,marginBottom:12},children:[(0,n.jsx)("input",{value:d,onChange:e=>c(e.target.value),placeholder:"بحث (المعرف/الاسم/الإيميل/الهاتف)",className:"input"}),(0,n.jsxs)("select",{value:l,onChange:e=>o(e.target.value),className:"select",children:[(0,n.jsx)("option",{value:"",children:"كل الحالات"}),(0,n.jsx)("option",{value:"PENDING",children:"قيد الانتظار"}),(0,n.jsx)("option",{value:"PAID",children:"مدفوع"}),(0,n.jsx)("option",{value:"SHIPPED",children:"تم الشحن"}),(0,n.jsx)("option",{value:"DELIVERED",children:"تم التسليم"}),(0,n.jsx)("option",{value:"CANCELLED",children:"ملغي"})]}),(0,n.jsxs)("select",{value:u,onChange:e=>h(e.target.value),className:"select",children:[(0,n.jsx)("option",{value:"",children:"كل السائقين"}),I.map(e=>(0,n.jsx)("option",{value:e.id,children:e.name},e.id))]}),(0,n.jsx)("input",{type:"date",value:p,onChange:e=>m(e.target.value),className:"input"}),(0,n.jsx)("input",{type:"date",value:x,onChange:e=>v(e.target.value),className:"input"}),(0,n.jsxs)("div",{style:{display:"flex",gap:8},children:[(0,n.jsx)("input",{type:"number",placeholder:"المبلغ من",value:g,onChange:e=>j(e.target.value),className:"input"}),(0,n.jsx)("input",{type:"number",placeholder:"إلى",value:y,onChange:e=>f(e.target.value),className:"input"})]}),(0,n.jsxs)("select",{value:b,onChange:e=>N(e.target.value),className:"select",children:[(0,n.jsx)("option",{value:"createdAt",children:"الأحدث"}),(0,n.jsx)("option",{value:"total",children:"الإجمالي"}),(0,n.jsx)("option",{value:"status",children:"الحالة"})]}),(0,n.jsxs)("select",{value:C,onChange:e=>S(e.target.value),className:"select",children:[(0,n.jsx)("option",{value:"desc",children:"تنازلي"}),(0,n.jsx)("option",{value:"asc",children:"تصاعدي"})]}),(0,n.jsx)("button",{onClick:()=>{t(1),K()},className:"btn",children:"تطبيق"}),(0,n.jsx)("div",{})]}),(0,n.jsx)("div",{style:{overflowX:"auto"},children:(0,n.jsxs)("table",{style:{width:"100%",borderCollapse:"separate",borderSpacing:0},children:[(0,n.jsx)("thead",{children:(0,n.jsxs)("tr",{children:[(0,n.jsx)("th",{style:{textAlign:"right",borderBottom:"1px solid var(--muted)",padding:10},children:"رقم الطلب"}),(0,n.jsx)("th",{style:{textAlign:"right",borderBottom:"1px solid var(--muted)",padding:10},children:"تاريخ"}),(0,n.jsx)("th",{style:{textAlign:"right",borderBottom:"1px solid var(--muted)",padding:10},children:"العميل"}),(0,n.jsx)("th",{style:{textAlign:"right",borderBottom:"1px solid var(--muted)",padding:10},children:"العنوان"}),(0,n.jsx)("th",{style:{textAlign:"right",borderBottom:"1px solid var(--muted)",padding:10},children:"عدد الأصناف"}),(0,n.jsx)("th",{style:{textAlign:"right",borderBottom:"1px solid var(--muted)",padding:10},children:"الإجمالي"}),(0,n.jsx)("th",{style:{textAlign:"right",borderBottom:"1px solid var(--muted)",padding:10},children:"حالة الطلب"}),(0,n.jsx)("th",{style:{textAlign:"right",borderBottom:"1px solid var(--muted)",padding:10},children:"حالة الدفع"}),(0,n.jsx)("th",{style:{textAlign:"right",borderBottom:"1px solid var(--muted)",padding:10},children:"حالة الشحن"}),(0,n.jsx)("th",{style:{textAlign:"right",borderBottom:"1px solid var(--muted)",padding:10},children:"السائق"}),(0,n.jsx)("th",{style:{textAlign:"right",borderBottom:"1px solid var(--muted)",padding:10},children:"إجراءات"})]})}),(0,n.jsxs)("tbody",{children:[T.map(e=>{var t,a,s,i,r,l,o,d,c,u,h;let p=(null===(a=e.shipments)||void 0===a?void 0:null===(t=a[0])||void 0===t?void 0:t.status)||("SHIPPED"===e.status?"IN_TRANSIT":"DELIVERED"===e.status?"DELIVERED":"-");return(0,n.jsxs)("tr",{children:[(0,n.jsx)("td",{style:{padding:10,borderBottom:"1px solid var(--muted)"},children:(0,n.jsx)("a",{href:"/orders/".concat(e.id),style:{color:"var(--text)"},children:e.id})}),(0,n.jsx)("td",{style:{padding:10,borderBottom:"1px solid var(--muted)"},children:new Date(e.createdAt).toLocaleString()}),(0,n.jsxs)("td",{style:{padding:10,borderBottom:"1px solid var(--muted)"},children:[(null===(s=e.user)||void 0===s?void 0:s.name)||"-",(0,n.jsx)("div",{style:{color:"var(--sub)"},children:(null===(i=e.user)||void 0===i?void 0:i.phone)||(null===(r=e.user)||void 0===r?void 0:r.email)||"-"})]}),(0,n.jsx)("td",{style:{padding:10,borderBottom:"1px solid var(--muted)"},children:(null===(l=e.shippingAddress)||void 0===l?void 0:l.street)||"-"}),(0,n.jsx)("td",{style:{padding:10,borderBottom:"1px solid var(--muted)"},children:(null===(o=e.items)||void 0===o?void 0:o.length)||0}),(0,n.jsx)("td",{style:{padding:10,borderBottom:"1px solid var(--muted)"},children:e.total}),(0,n.jsx)("td",{style:{padding:10,borderBottom:"1px solid var(--muted)"},children:e.status}),(0,n.jsx)("td",{style:{padding:10,borderBottom:"1px solid var(--muted)"},children:(null===(d=e.payment)||void 0===d?void 0:d.status)||"-"}),(0,n.jsx)("td",{style:{padding:10,borderBottom:"1px solid var(--muted)"},children:p}),(0,n.jsx)("td",{style:{padding:10,borderBottom:"1px solid var(--muted)"},children:(null===(c=e.assignedDriver)||void 0===c?void 0:c.name)||"-"}),(0,n.jsxs)("td",{style:{padding:10,borderBottom:"1px solid var(--muted)"},children:[(0,n.jsxs)("div",{style:{display:"flex",gap:6,flexWrap:"wrap"},children:[(0,n.jsx)("a",{href:"/orders/".concat(e.id),className:"btn","aria-label":"عرض",children:"عرض"}),(0,n.jsx)("button",{onClick:()=>Q(e.id),className:"btn","aria-label":"شحن",children:"شحن"}),(0,n.jsx)("button",{onClick:()=>Y(e.id),className:"btn","aria-label":"استرداد",children:"استرداد"}),(0,n.jsx)("a",{href:"".concat(G,"/api/admin/shipments/").concat((null===(h=e.shipments)||void 0===h?void 0:null===(u=h[0])||void 0===u?void 0:u.id)||"","/label"),className:"btn","aria-label":"فاتورة",children:"فاتورة"})]}),(0,n.jsx)("div",{style:{marginTop:6},children:(0,n.jsxs)("select",{onChange:t=>Z(e.id,t.target.value),className:"select","aria-label":"تعيين سائق",children:[(0,n.jsx)("option",{value:"",children:"تعيين سائق…"}),I.map(e=>(0,n.jsx)("option",{value:e.id,children:e.name},e.id))]})})]})]},e.id)}),!T.length&&(0,n.jsx)("tr",{children:(0,n.jsx)("td",{colSpan:11,style:{padding:12,color:"var(--sub)"},children:A?"جارٍ التحميل…":"لا توجد نتائج"})})]})]})}),(0,n.jsxs)("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",marginTop:12},children:[(0,n.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:8},children:[(0,n.jsx)("button",{disabled:e<=1,onClick:()=>t(e=>Math.max(1,e-1)),className:"icon-btn",children:"السابق"}),(0,n.jsxs)("div",{style:{color:"var(--sub)"},children:["صفحة ",e," من ",Math.max(1,Math.ceil(B/a))]}),(0,n.jsx)("button",{disabled:e*a>=B,onClick:()=>t(e=>e+1),className:"icon-btn",children:"التالي"})]}),(0,n.jsx)("div",{children:(0,n.jsx)("select",{value:a,onChange:e=>{r(Number(e.target.value)),t(1)},className:"select",children:[10,20,50,100].map(e=>(0,n.jsxs)("option",{value:e,children:[e," / صفحة"]},e))})})]})]}),D&&(0,n.jsx)("div",{style:{position:"fixed",inset:0,background:"rgba(0,0,0,0.5)",display:"grid",placeItems:"center",zIndex:60},children:(0,n.jsxs)("div",{className:"panel",style:{width:720},children:[(0,n.jsx)("h3",{style:{marginTop:0},children:"إنشاء طلب"}),(0,n.jsxs)("div",{className:"grid",style:{gridTemplateColumns:"1fr 1fr",gap:10},children:[(0,n.jsx)("input",{className:"input",placeholder:"اسم العميل",value:R,onChange:e=>q(e.target.value)}),(0,n.jsx)("input",{className:"input",placeholder:"البريد",value:M,onChange:e=>J(e.target.value)}),(0,n.jsx)("input",{className:"input",placeholder:"الهاتف",value:U,onChange:e=>V(e.target.value)}),(0,n.jsx)("input",{className:"input",placeholder:"العنوان",value:z,onChange:e=>F(e.target.value)})]}),(0,n.jsxs)("div",{style:{marginTop:12},children:[(0,n.jsx)("div",{style:{color:"var(--sub)",marginBottom:6},children:"الأصناف"}),H.map((e,t)=>(0,n.jsxs)("div",{className:"grid",style:{gridTemplateColumns:"1fr 1fr 1fr auto",gap:8,marginBottom:8},children:[(0,n.jsx)("input",{className:"input",placeholder:"Product ID",value:e.productId,onChange:e=>{let a=[...H];a[t].productId=e.target.value,X(a)}}),(0,n.jsx)("input",{className:"input",type:"number",placeholder:"الكمية",value:e.quantity,onChange:e=>{let a=[...H];a[t].quantity=Number(e.target.value||1),X(a)}}),(0,n.jsx)("input",{className:"input",type:"number",placeholder:"السعر (اختياري)",value:e.price||"",onChange:e=>{let a=[...H];a[t].price=Number(e.target.value||0)||void 0,X(a)}}),(0,n.jsx)("button",{className:"icon-btn",onClick:()=>{let e=H.filter((e,a)=>a!==t);X(e.length?e:[{productId:"",quantity:1}])},children:"حذف"})]},t)),(0,n.jsx)("button",{className:"icon-btn",onClick:()=>X(e=>[...e,{productId:"",quantity:1}]),children:"إضافة صنف"})]}),(0,n.jsxs)("div",{style:{display:"flex",justifyContent:"flex-end",gap:8,marginTop:12},children:[(0,n.jsx)("button",{className:"icon-btn",onClick:()=>L(!1),children:"إلغاء"}),(0,n.jsx)("button",{className:"btn",disabled:_,onClick:async()=>{O(!0);try{(await fetch("".concat(G,"/api/admin/orders"),{method:"POST",headers:{"content-type":"application/json",...W()},credentials:"include",body:JSON.stringify({customer:{name:R,email:M,phone:U},address:{street:z},items:H})})).ok&&(L(!1),q(""),J(""),V(""),F(""),X([{productId:"",quantity:1}]),await K())}finally{O(!1)}},children:_?"جارٍ الإنشاء…":"تأكيد"})]})]})})]})}},5009:function(e,t,a){"use strict";var n,s;e.exports=(null==(n=a.g.process)?void 0:n.env)&&"object"==typeof(null==(s=a.g.process)?void 0:s.env)?a.g.process:a(4634)},4634:function(e){!function(){var t={229:function(e){var t,a,n,s=e.exports={};function i(){throw Error("setTimeout has not been defined")}function r(){throw Error("clearTimeout has not been defined")}function l(e){if(t===setTimeout)return setTimeout(e,0);if((t===i||!t)&&setTimeout)return t=setTimeout,setTimeout(e,0);try{return t(e,0)}catch(a){try{return t.call(null,e,0)}catch(a){return t.call(this,e,0)}}}!function(){try{t="function"==typeof setTimeout?setTimeout:i}catch(e){t=i}try{a="function"==typeof clearTimeout?clearTimeout:r}catch(e){a=r}}();var o=[],d=!1,c=-1;function u(){d&&n&&(d=!1,n.length?o=n.concat(o):c=-1,o.length&&h())}function h(){if(!d){var e=l(u);d=!0;for(var t=o.length;t;){for(n=o,o=[];++c<t;)n&&n[c].run();c=-1,t=o.length}n=null,d=!1,function(e){if(a===clearTimeout)return clearTimeout(e);if((a===r||!a)&&clearTimeout)return a=clearTimeout,clearTimeout(e);try{a(e)}catch(t){try{return a.call(null,e)}catch(t){return a.call(this,e)}}}(e)}}function p(e,t){this.fun=e,this.array=t}function m(){}s.nextTick=function(e){var t=Array(arguments.length-1);if(arguments.length>1)for(var a=1;a<arguments.length;a++)t[a-1]=arguments[a];o.push(new p(e,t)),1!==o.length||d||l(h)},p.prototype.run=function(){this.fun.apply(null,this.array)},s.title="browser",s.browser=!0,s.env={},s.argv=[],s.version="",s.versions={},s.on=m,s.addListener=m,s.once=m,s.off=m,s.removeListener=m,s.removeAllListeners=m,s.emit=m,s.prependListener=m,s.prependOnceListener=m,s.listeners=function(e){return[]},s.binding=function(e){throw Error("process.binding is not supported")},s.cwd=function(){return"/"},s.chdir=function(e){throw Error("process.chdir is not supported")},s.umask=function(){return 0}}},a={};function n(e){var s=a[e];if(void 0!==s)return s.exports;var i=a[e]={exports:{}},r=!0;try{t[e](i,i.exports,n),r=!1}finally{r&&delete a[e]}return i.exports}n.ab="//";var s=n(229);e.exports=s}()}},function(e){e.O(0,[64,694,744],function(){return e(e.s=159)}),_N_E=e.O()}]);