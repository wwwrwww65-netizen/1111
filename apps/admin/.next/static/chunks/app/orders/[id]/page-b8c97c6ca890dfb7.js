(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[12],{1885:function(e,t,n){Promise.resolve().then(n.bind(n,3038))},3038:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return l}});var i=n(875),r=n(5393),s=n(5009);function l(e){var t,n,l,d,o,a,c;let{params:u}=e,{id:h}=u,[p,v]=r.useState(null),[m,x]=r.useState(!1),[f,g]=r.useState(!1),[j,y]=r.useState(""),[b,T]=r.useState(""),[w,N]=r.useState(""),[k,C]=r.useState(""),[S,B]=r.useState([]),[A,_]=r.useState([]),E=r.useMemo(()=>s.env.NEXT_PUBLIC_API_BASE_URL||window.location.origin.replace("jeeey-manger","jeeeyai"),[]),I=r.useCallback(()=>{if("undefined"==typeof document)return{};let e=document.cookie.match(/(?:^|; )auth_token=([^;]+)/);return e?{Authorization:"Bearer ".concat(decodeURIComponent(e[1]))}:{}},[]);async function L(){if(null==p?void 0:p.id){g(!0);try{let e=await fetch("".concat(E,"/api/admin/shipments"),{method:"POST",headers:{"content-type":"application/json",...I()},credentials:"include",body:JSON.stringify({orderId:p.id,driverId:j||void 0,carrierId:b||void 0,weight:w||void 0,dimensions:k||void 0})});if(e.ok){await e.json(),x(!1);let t=await (await fetch("".concat(E,"/api/admin/orders/").concat(h),{credentials:"include",headers:{...I()},cache:"no-store"})).json();v(t.order||null)}}finally{g(!1)}}}return(r.useEffect(()=>{(async()=>{try{let[e,t,n]=await Promise.all([fetch("".concat(E,"/api/admin/orders/").concat(h),{credentials:"include",headers:{...I()},cache:"no-store"}).then(e=>e.json()),fetch("".concat(E,"/api/admin/drivers"),{credentials:"include",headers:{...I()}}).then(e=>e.json()),fetch("".concat(E,"/api/admin/carriers"),{credentials:"include",headers:{...I()}}).then(e=>e.json())]);v(e.order||null),B(t.drivers||[]),_(n.carriers||[])}catch(e){}})()},[E,h]),p)?(0,i.jsxs)("main",{className:"grid",style:{gap:16},children:[(0,i.jsxs)("div",{className:"panel",children:[(0,i.jsxs)("h2",{style:{marginTop:0},children:["الطلب #",p.id]}),(0,i.jsxs)("div",{className:"grid cols-2",children:[(0,i.jsxs)("div",{children:[(0,i.jsx)("div",{style:{color:"var(--sub)"},children:"العميل"}),(0,i.jsxs)("div",{children:[(null===(t=p.user)||void 0===t?void 0:t.name)||"-"," — ",(null===(n=p.user)||void 0===n?void 0:n.email)||"-"," — ",(null===(l=p.user)||void 0===l?void 0:l.phone)||"-"]}),(0,i.jsx)("div",{style:{color:"var(--sub)",marginTop:8},children:"العنوان"}),(0,i.jsx)("div",{children:(null===(d=p.shippingAddress)||void 0===d?void 0:d.street)||"-"}),(0,i.jsx)("div",{style:{color:"var(--sub)",marginTop:8},children:"ملاحظات"}),(0,i.jsx)("div",{children:"-"})]}),(0,i.jsxs)("div",{children:[(0,i.jsx)("div",{style:{color:"var(--sub)"},children:"ملخص المبلغ"}),(0,i.jsxs)("div",{children:["Subtotal: ",(null===(o=p.items)||void 0===o?void 0:o.reduce((e,t)=>e+t.price*t.quantity,0))||0]}),(0,i.jsx)("div",{children:"Shipping: 0"}),(0,i.jsx)("div",{children:"Tax: 0"}),(0,i.jsxs)("div",{children:["Total: ",p.total]})]})]})]}),(0,i.jsxs)("div",{className:"panel",children:[(0,i.jsx)("h3",{style:{marginTop:0},children:"الأصناف"}),(0,i.jsx)("div",{style:{overflowX:"auto"},children:(0,i.jsxs)("table",{style:{width:"100%",borderCollapse:"separate",borderSpacing:0},children:[(0,i.jsx)("thead",{children:(0,i.jsxs)("tr",{children:[(0,i.jsx)("th",{style:{textAlign:"right",padding:10,borderBottom:"1px solid var(--muted)"},children:"الصورة"}),(0,i.jsx)("th",{style:{textAlign:"right",padding:10,borderBottom:"1px solid var(--muted)"},children:"الاسم"}),(0,i.jsx)("th",{style:{textAlign:"right",padding:10,borderBottom:"1px solid var(--muted)"},children:"الكمية"}),(0,i.jsx)("th",{style:{textAlign:"right",padding:10,borderBottom:"1px solid var(--muted)"},children:"السعر"}),(0,i.jsx)("th",{style:{textAlign:"right",padding:10,borderBottom:"1px solid var(--muted)"},children:"المجموع"})]})}),(0,i.jsx)("tbody",{children:null===(a=p.items)||void 0===a?void 0:a.map((e,t)=>{var n;return(0,i.jsxs)("tr",{style:{background:t%2?"#0a0e17":"transparent"},children:[(0,i.jsx)("td",{style:{padding:10,borderBottom:"1px solid var(--muted)"},children:(0,i.jsx)("div",{style:{width:64,height:64,background:"#111",borderRadius:8}})}),(0,i.jsx)("td",{style:{padding:10,borderBottom:"1px solid var(--muted)"},children:(null===(n=e.product)||void 0===n?void 0:n.name)||"-"}),(0,i.jsx)("td",{style:{padding:10,borderBottom:"1px solid var(--muted)"},children:e.quantity}),(0,i.jsx)("td",{style:{padding:10,borderBottom:"1px solid var(--muted)"},children:e.price}),(0,i.jsx)("td",{style:{padding:10,borderBottom:"1px solid var(--muted)"},children:e.price*e.quantity})]},e.id)})})]})})]}),(0,i.jsxs)("div",{className:"panel",children:[(0,i.jsx)("h3",{style:{marginTop:0},children:"الشحن"}),(0,i.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,i.jsx)("div",{children:null===(c=p.shipments)||void 0===c?void 0:c.map(e=>(0,i.jsxs)("div",{style:{marginBottom:6},children:["#",e.id," — ",e.status," — ",e.trackingNumber||"-"," ",(0,i.jsx)("a",{href:"".concat(E,"/api/admin/shipments/").concat(e.id,"/label"),style:{marginInlineStart:8},children:"الملصق"})]},e.id))}),(0,i.jsx)("button",{className:"btn",onClick:()=>x(!0),children:"إنشاء شحنة"})]})]}),(0,i.jsxs)("div",{className:"panel",children:[(0,i.jsx)("h3",{style:{marginTop:0},children:"Timeline"}),(0,i.jsx)("div",{style:{color:"var(--sub)"},children:"Placeholder للأحداث (تم الإنشاء، الدفع، الإسناد، الشحن، التسليم…)"})]}),m&&(0,i.jsx)("div",{style:{position:"fixed",inset:0,background:"rgba(0,0,0,0.5)",display:"grid",placeItems:"center",zIndex:60},children:(0,i.jsxs)("div",{className:"panel",style:{width:720},children:[(0,i.jsx)("h3",{style:{marginTop:0},children:"Create Shipment"}),(0,i.jsxs)("div",{className:"grid",style:{gridTemplateColumns:"1fr 1fr",gap:12},children:[(0,i.jsxs)("select",{value:j,onChange:e=>y(e.target.value),className:"select",children:[(0,i.jsx)("option",{value:"",children:"اختيار سائق (اختياري)"}),S.map(e=>(0,i.jsx)("option",{value:e.id,children:e.name},e.id))]}),(0,i.jsxs)("select",{value:b,onChange:e=>T(e.target.value),className:"select",children:[(0,i.jsx)("option",{value:"",children:"اختيار مزود (اختياري)"}),A.map(e=>(0,i.jsx)("option",{value:e.id,children:e.name},e.id))]}),(0,i.jsx)("input",{placeholder:"الوزن (كجم)",value:w,onChange:e=>N(e.target.value),className:"input"}),(0,i.jsx)("input",{placeholder:"الأبعاد (LxWxH)",value:k,onChange:e=>C(e.target.value),className:"input"})]}),(0,i.jsxs)("div",{style:{display:"flex",justifyContent:"flex-end",gap:8,marginTop:12},children:[(0,i.jsx)("button",{className:"icon-btn",onClick:()=>x(!1),children:"إلغاء"}),(0,i.jsx)("button",{className:"btn",disabled:f,onClick:L,children:f?"جارٍ الإنشاء…":"تأكيد"})]})]})})]}):(0,i.jsx)("main",{className:"panel",children:"جارٍ التحميل…"})}},5009:function(e,t,n){"use strict";var i,r;e.exports=(null==(i=n.g.process)?void 0:i.env)&&"object"==typeof(null==(r=n.g.process)?void 0:r.env)?n.g.process:n(4634)},4634:function(e){!function(){var t={229:function(e){var t,n,i,r=e.exports={};function s(){throw Error("setTimeout has not been defined")}function l(){throw Error("clearTimeout has not been defined")}function d(e){if(t===setTimeout)return setTimeout(e,0);if((t===s||!t)&&setTimeout)return t=setTimeout,setTimeout(e,0);try{return t(e,0)}catch(n){try{return t.call(null,e,0)}catch(n){return t.call(this,e,0)}}}!function(){try{t="function"==typeof setTimeout?setTimeout:s}catch(e){t=s}try{n="function"==typeof clearTimeout?clearTimeout:l}catch(e){n=l}}();var o=[],a=!1,c=-1;function u(){a&&i&&(a=!1,i.length?o=i.concat(o):c=-1,o.length&&h())}function h(){if(!a){var e=d(u);a=!0;for(var t=o.length;t;){for(i=o,o=[];++c<t;)i&&i[c].run();c=-1,t=o.length}i=null,a=!1,function(e){if(n===clearTimeout)return clearTimeout(e);if((n===l||!n)&&clearTimeout)return n=clearTimeout,clearTimeout(e);try{n(e)}catch(t){try{return n.call(null,e)}catch(t){return n.call(this,e)}}}(e)}}function p(e,t){this.fun=e,this.array=t}function v(){}r.nextTick=function(e){var t=Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];o.push(new p(e,t)),1!==o.length||a||d(h)},p.prototype.run=function(){this.fun.apply(null,this.array)},r.title="browser",r.browser=!0,r.env={},r.argv=[],r.version="",r.versions={},r.on=v,r.addListener=v,r.once=v,r.off=v,r.removeListener=v,r.removeAllListeners=v,r.emit=v,r.prependListener=v,r.prependOnceListener=v,r.listeners=function(e){return[]},r.binding=function(e){throw Error("process.binding is not supported")},r.cwd=function(){return"/"},r.chdir=function(e){throw Error("process.chdir is not supported")},r.umask=function(){return 0}}},n={};function i(e){var r=n[e];if(void 0!==r)return r.exports;var s=n[e]={exports:{}},l=!0;try{t[e](s,s.exports,i),l=!1}finally{l&&delete n[e]}return s.exports}i.ab="//";var r=i(229);e.exports=r}()}},function(e){e.O(0,[64,694,744],function(){return e(e.s=1885)}),_N_E=e.O()}]);