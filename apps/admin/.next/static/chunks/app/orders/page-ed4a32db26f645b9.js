(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[569],{159:function(e,t,n){Promise.resolve().then(n.bind(n,2287))},2287:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return s}});var r=n(875),a=n(5393),i=n(5009);function s(){let[e,t]=a.useState(1),[n,s]=a.useState(20),[l,o]=a.useState(""),[d,c]=a.useState(""),[u,h]=a.useState(""),[p,m]=a.useState(""),[v,x]=a.useState(""),[g,j]=a.useState(""),[f,y]=a.useState(""),[b,N]=a.useState("createdAt"),[S,w]=a.useState("desc"),[B,T]=a.useState([]),[C,E]=a.useState(0),[A,P]=a.useState([]),[I,k]=a.useState(!1),D=a.useMemo(()=>i.env.NEXT_PUBLIC_API_BASE_URL||window.location.origin.replace("jeeey-manger","jeeeyai"),[]),L=a.useCallback(()=>{if("undefined"==typeof document)return{};let e=document.cookie.match(/(?:^|; )auth_token=([^;]+)/);return e?{Authorization:"Bearer ".concat(decodeURIComponent(e[1]))}:{}},[]);async function _(){var t;let r=new URL("".concat(D,"/api/admin/orders/list"));r.searchParams.set("page",String(e)),r.searchParams.set("limit",String(n)),l&&r.searchParams.set("status",l),d&&r.searchParams.set("search",d),u&&r.searchParams.set("driverId",u),p&&r.searchParams.set("dateFrom",p),v&&r.searchParams.set("dateTo",v),g&&r.searchParams.set("amountMin",g),f&&r.searchParams.set("amountMax",f),b&&r.searchParams.set("sortBy",b),S&&r.searchParams.set("sortDir",S),k(!0);let a=await fetch(r.toString(),{credentials:"include",headers:{...L()},cache:"no-store"}),i=await a.json();k(!1),T(i.orders||[]),E((null===(t=i.pagination)||void 0===t?void 0:t.total)||0)}async function O(e){await fetch("".concat(D,"/api/admin/orders/ship"),{method:"POST",headers:{"content-type":"application/json",...L()},credentials:"include",body:JSON.stringify({orderId:e})}),await _()}async function R(e){await fetch("".concat(D,"/api/admin/payments/refund"),{method:"POST",headers:{"content-type":"application/json",...L()},credentials:"include",body:JSON.stringify({orderId:e})}),await _()}async function M(e,t){await fetch("".concat(D,"/api/admin/orders/assign-driver"),{method:"POST",headers:{"content-type":"application/json",...L()},credentials:"include",body:JSON.stringify({orderId:e,driverId:t})}),await _()}return a.useEffect(()=>{_()},[e,n,b,S]),a.useEffect(()=>{(async()=>{try{let e=await (await fetch("".concat(D,"/api/admin/drivers"),{credentials:"include",headers:{...L()}})).json();P(e.drivers||[])}catch(e){}})()},[D]),(0,r.jsxs)("main",{className:"panel",children:[(0,r.jsx)("h1",{style:{marginBottom:16},children:"الطلبات"}),(0,r.jsxs)("div",{className:"grid",style:{gridTemplateColumns:"repeat(6,1fr)",gap:8,marginBottom:12},children:[(0,r.jsx)("input",{value:d,onChange:e=>c(e.target.value),placeholder:"بحث (المعرف/الاسم/الإيميل/الهاتف)",className:"input"}),(0,r.jsxs)("select",{value:l,onChange:e=>o(e.target.value),className:"select",children:[(0,r.jsx)("option",{value:"",children:"كل الحالات"}),(0,r.jsx)("option",{value:"PENDING",children:"قيد الانتظار"}),(0,r.jsx)("option",{value:"PAID",children:"مدفوع"}),(0,r.jsx)("option",{value:"SHIPPED",children:"تم الشحن"}),(0,r.jsx)("option",{value:"DELIVERED",children:"تم التسليم"}),(0,r.jsx)("option",{value:"CANCELLED",children:"ملغي"})]}),(0,r.jsxs)("select",{value:u,onChange:e=>h(e.target.value),className:"select",children:[(0,r.jsx)("option",{value:"",children:"كل السائقين"}),A.map(e=>(0,r.jsx)("option",{value:e.id,children:e.name},e.id))]}),(0,r.jsx)("input",{type:"date",value:p,onChange:e=>m(e.target.value),className:"input"}),(0,r.jsx)("input",{type:"date",value:v,onChange:e=>x(e.target.value),className:"input"}),(0,r.jsxs)("div",{style:{display:"flex",gap:8},children:[(0,r.jsx)("input",{type:"number",placeholder:"المبلغ من",value:g,onChange:e=>j(e.target.value),className:"input"}),(0,r.jsx)("input",{type:"number",placeholder:"إلى",value:f,onChange:e=>y(e.target.value),className:"input"})]}),(0,r.jsxs)("select",{value:b,onChange:e=>N(e.target.value),className:"select",children:[(0,r.jsx)("option",{value:"createdAt",children:"الأحدث"}),(0,r.jsx)("option",{value:"total",children:"الإجمالي"}),(0,r.jsx)("option",{value:"status",children:"الحالة"})]}),(0,r.jsxs)("select",{value:S,onChange:e=>w(e.target.value),className:"select",children:[(0,r.jsx)("option",{value:"desc",children:"تنازلي"}),(0,r.jsx)("option",{value:"asc",children:"تصاعدي"})]}),(0,r.jsx)("button",{onClick:()=>{t(1),_()},className:"btn",children:"تطبيق"}),(0,r.jsx)("div",{})]}),(0,r.jsx)("div",{style:{overflowX:"auto"},children:(0,r.jsxs)("table",{style:{width:"100%",borderCollapse:"separate",borderSpacing:0},children:[(0,r.jsx)("thead",{children:(0,r.jsxs)("tr",{children:[(0,r.jsx)("th",{style:{textAlign:"right",borderBottom:"1px solid var(--muted)",padding:10},children:"رقم الطلب"}),(0,r.jsx)("th",{style:{textAlign:"right",borderBottom:"1px solid var(--muted)",padding:10},children:"تاريخ"}),(0,r.jsx)("th",{style:{textAlign:"right",borderBottom:"1px solid var(--muted)",padding:10},children:"العميل"}),(0,r.jsx)("th",{style:{textAlign:"right",borderBottom:"1px solid var(--muted)",padding:10},children:"العنوان"}),(0,r.jsx)("th",{style:{textAlign:"right",borderBottom:"1px solid var(--muted)",padding:10},children:"عدد الأصناف"}),(0,r.jsx)("th",{style:{textAlign:"right",borderBottom:"1px solid var(--muted)",padding:10},children:"الإجمالي"}),(0,r.jsx)("th",{style:{textAlign:"right",borderBottom:"1px solid var(--muted)",padding:10},children:"حالة الطلب"}),(0,r.jsx)("th",{style:{textAlign:"right",borderBottom:"1px solid var(--muted)",padding:10},children:"حالة الدفع"}),(0,r.jsx)("th",{style:{textAlign:"right",borderBottom:"1px solid var(--muted)",padding:10},children:"حالة الشحن"}),(0,r.jsx)("th",{style:{textAlign:"right",borderBottom:"1px solid var(--muted)",padding:10},children:"السائق"}),(0,r.jsx)("th",{style:{textAlign:"right",borderBottom:"1px solid var(--muted)",padding:10},children:"إجراءات"})]})}),(0,r.jsxs)("tbody",{children:[B.map(e=>{var t,n,a,i,s,l,o,d,c,u,h;let p=(null===(n=e.shipments)||void 0===n?void 0:null===(t=n[0])||void 0===t?void 0:t.status)||("SHIPPED"===e.status?"IN_TRANSIT":"DELIVERED"===e.status?"DELIVERED":"-");return(0,r.jsxs)("tr",{children:[(0,r.jsx)("td",{style:{padding:10,borderBottom:"1px solid var(--muted)"},children:(0,r.jsx)("a",{href:"/orders/".concat(e.id),style:{color:"var(--text)"},children:e.id})}),(0,r.jsx)("td",{style:{padding:10,borderBottom:"1px solid var(--muted)"},children:new Date(e.createdAt).toLocaleString()}),(0,r.jsxs)("td",{style:{padding:10,borderBottom:"1px solid var(--muted)"},children:[(null===(a=e.user)||void 0===a?void 0:a.name)||"-",(0,r.jsx)("div",{style:{color:"var(--sub)"},children:(null===(i=e.user)||void 0===i?void 0:i.phone)||(null===(s=e.user)||void 0===s?void 0:s.email)||"-"})]}),(0,r.jsx)("td",{style:{padding:10,borderBottom:"1px solid var(--muted)"},children:(null===(l=e.shippingAddress)||void 0===l?void 0:l.street)||"-"}),(0,r.jsx)("td",{style:{padding:10,borderBottom:"1px solid var(--muted)"},children:(null===(o=e.items)||void 0===o?void 0:o.length)||0}),(0,r.jsx)("td",{style:{padding:10,borderBottom:"1px solid var(--muted)"},children:e.total}),(0,r.jsx)("td",{style:{padding:10,borderBottom:"1px solid var(--muted)"},children:e.status}),(0,r.jsx)("td",{style:{padding:10,borderBottom:"1px solid var(--muted)"},children:(null===(d=e.payment)||void 0===d?void 0:d.status)||"-"}),(0,r.jsx)("td",{style:{padding:10,borderBottom:"1px solid var(--muted)"},children:p}),(0,r.jsx)("td",{style:{padding:10,borderBottom:"1px solid var(--muted)"},children:(null===(c=e.assignedDriver)||void 0===c?void 0:c.name)||"-"}),(0,r.jsxs)("td",{style:{padding:10,borderBottom:"1px solid var(--muted)"},children:[(0,r.jsxs)("div",{style:{display:"flex",gap:6,flexWrap:"wrap"},children:[(0,r.jsx)("a",{href:"/orders/".concat(e.id),className:"btn","aria-label":"عرض",children:"عرض"}),(0,r.jsx)("button",{onClick:()=>O(e.id),className:"btn","aria-label":"شحن",children:"شحن"}),(0,r.jsx)("button",{onClick:()=>R(e.id),className:"btn","aria-label":"استرداد",children:"استرداد"}),(0,r.jsx)("a",{href:"".concat(D,"/api/admin/shipments/").concat((null===(h=e.shipments)||void 0===h?void 0:null===(u=h[0])||void 0===u?void 0:u.id)||"","/label"),className:"btn","aria-label":"فاتورة",children:"فاتورة"})]}),(0,r.jsx)("div",{style:{marginTop:6},children:(0,r.jsxs)("select",{onChange:t=>M(e.id,t.target.value),className:"select","aria-label":"تعيين سائق",children:[(0,r.jsx)("option",{value:"",children:"تعيين سائق…"}),A.map(e=>(0,r.jsx)("option",{value:e.id,children:e.name},e.id))]})})]})]},e.id)}),!B.length&&(0,r.jsx)("tr",{children:(0,r.jsx)("td",{colSpan:11,style:{padding:12,color:"var(--sub)"},children:I?"جارٍ التحميل…":"لا توجد نتائج"})})]})]})}),(0,r.jsxs)("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",marginTop:12},children:[(0,r.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:8},children:[(0,r.jsx)("button",{disabled:e<=1,onClick:()=>t(e=>Math.max(1,e-1)),className:"icon-btn",children:"السابق"}),(0,r.jsxs)("div",{style:{color:"var(--sub)"},children:["صفحة ",e," من ",Math.max(1,Math.ceil(C/n))]}),(0,r.jsx)("button",{disabled:e*n>=C,onClick:()=>t(e=>e+1),className:"icon-btn",children:"التالي"})]}),(0,r.jsx)("div",{children:(0,r.jsx)("select",{value:n,onChange:e=>{s(Number(e.target.value)),t(1)},className:"select",children:[10,20,50,100].map(e=>(0,r.jsxs)("option",{value:e,children:[e," / صفحة"]},e))})})]})]})}},5009:function(e,t,n){"use strict";var r,a;e.exports=(null==(r=n.g.process)?void 0:r.env)&&"object"==typeof(null==(a=n.g.process)?void 0:a.env)?n.g.process:n(4634)},4634:function(e){!function(){var t={229:function(e){var t,n,r,a=e.exports={};function i(){throw Error("setTimeout has not been defined")}function s(){throw Error("clearTimeout has not been defined")}function l(e){if(t===setTimeout)return setTimeout(e,0);if((t===i||!t)&&setTimeout)return t=setTimeout,setTimeout(e,0);try{return t(e,0)}catch(n){try{return t.call(null,e,0)}catch(n){return t.call(this,e,0)}}}!function(){try{t="function"==typeof setTimeout?setTimeout:i}catch(e){t=i}try{n="function"==typeof clearTimeout?clearTimeout:s}catch(e){n=s}}();var o=[],d=!1,c=-1;function u(){d&&r&&(d=!1,r.length?o=r.concat(o):c=-1,o.length&&h())}function h(){if(!d){var e=l(u);d=!0;for(var t=o.length;t;){for(r=o,o=[];++c<t;)r&&r[c].run();c=-1,t=o.length}r=null,d=!1,function(e){if(n===clearTimeout)return clearTimeout(e);if((n===s||!n)&&clearTimeout)return n=clearTimeout,clearTimeout(e);try{n(e)}catch(t){try{return n.call(null,e)}catch(t){return n.call(this,e)}}}(e)}}function p(e,t){this.fun=e,this.array=t}function m(){}a.nextTick=function(e){var t=Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];o.push(new p(e,t)),1!==o.length||d||l(h)},p.prototype.run=function(){this.fun.apply(null,this.array)},a.title="browser",a.browser=!0,a.env={},a.argv=[],a.version="",a.versions={},a.on=m,a.addListener=m,a.once=m,a.off=m,a.removeListener=m,a.removeAllListeners=m,a.emit=m,a.prependListener=m,a.prependOnceListener=m,a.listeners=function(e){return[]},a.binding=function(e){throw Error("process.binding is not supported")},a.cwd=function(){return"/"},a.chdir=function(e){throw Error("process.chdir is not supported")},a.umask=function(){return 0}}},n={};function r(e){var a=n[e];if(void 0!==a)return a.exports;var i=n[e]={exports:{}},s=!0;try{t[e](i,i.exports,r),s=!1}finally{s&&delete n[e]}return i.exports}r.ab="//";var a=r(229);e.exports=a}()}},function(e){e.O(0,[64,694,744],function(){return e(e.s=159)}),_N_E=e.O()}]);