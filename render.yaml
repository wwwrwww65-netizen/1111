services:
  - type: web
    name: ecom-api
    env: node
    plan: free
    region: oregon
    buildCommand: pnpm install --frozen-lockfile=false && pnpm --filter @repo/db db:generate && pnpm --filter @repo/api build
    startCommand: node -e "process.env.DATABASE_URL?console.log('DB_URL set'):console.log('DB_URL missing');" && npx prisma migrate deploy || npx prisma db push && node packages/api/dist/index.js
    healthCheckPath: /health
    autoDeploy: true
  - type: web
    name: ecom-web
    env: node
    plan: free
    region: oregon
    buildCommand: pnpm install --no-frozen-lockfile && pnpm --filter web build
    startCommand: node apps/web/render-start.js
    healthCheckPath: /
    autoDeploy: true
  - type: web
    name: ecom-admin
    env: node
    plan: free
    region: oregon
    buildCommand: pnpm install --frozen-lockfile=false && pnpm --filter admin build
    startCommand: pnpm --filter admin start
    healthCheckPath: /
    autoDeploy: true
