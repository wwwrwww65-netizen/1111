import React, { useEffect, useRef, useState } from "react";
import {
  Menu,
  Bell,
  ShoppingCart,
  Search,
  ShoppingBag,
  LayoutGrid,
  User,
  ChevronLeft,
  Store,
} from "lucide-react";

interface Props {
  className?: string;
}

const SheinHome: React.FC<Props> = ({ className = "" }) => {
  // Data
  const categories = [
    { name: "ÙØ³Ø§ØªÙŠÙ†", image: "https://csspicker.dev/api/image/?q=dress&image_type=photo" },
    { name: "Ø£Ø­Ø°ÙŠØ©", image: "https://csspicker.dev/api/image/?q=shoes+footwear&image_type=photo" },
    { name: "Ø­Ù‚Ø§Ø¦Ø¨", image: "https://csspicker.dev/api/image/?q=handbag&image_type=photo" },
    { name: "Ù…Ù„Ø§Ø¨Ø³ Ø±ÙŠØ§Ø¶ÙŠØ©", image: "https://csspicker.dev/api/image/?q=sportswear&image_type=photo" },
    { name: "Ø¥ÙƒØ³Ø³ÙˆØ§Ø±Ø§Øª", image: "https://csspicker.dev/api/image/?q=fashion+accessories&image_type=photo" },
    { name: "Ù…Ø¬ÙˆÙ‡Ø±Ø§Øª", image: "https://csspicker.dev/api/image/?q=jewelry&image_type=photo" },
    { name: "Ø£Ø²ÙŠØ§Ø¡ Ù†Ø³Ø§Ø¦ÙŠØ©", image: "https://csspicker.dev/api/image/?q=women+fashion&image_type=photo" },
    { name: "Ø£Ø²ÙŠØ§Ø¡ Ø±Ø¬Ø§Ù„ÙŠØ©", image: "https://csspicker.dev/api/image/?q=men+fashion&image_type=photo" },
    { name: "Ø£Ø²ÙŠØ§Ø¡ Ø§Ù„Ø£Ø·ÙØ§Ù„", image: "https://csspicker.dev/api/image/?q=kids+fashion&image_type=photo" },
    { name: "Ø¬Ù…Ø§Ù„ ÙˆØµØ­Ø©", image: "https://csspicker.dev/api/image/?q=beauty+cosmetics&image_type=photo" },
    { name: "Ù…Ù†Ø²Ù„ ÙˆØ­Ø¯ÙŠÙ‚Ø©", image: "https://csspicker.dev/api/image/?q=home+garden&image_type=photo" },
    { name: "Ø¨Ù„ÙˆØ²Ø§Øª", image: "https://csspicker.dev/api/image/?q=blouse&image_type=photo" },
    { name: "ØªÙ†ÙˆØ±Ø§Øª", image: "https://csspicker.dev/api/image/?q=skirt&image_type=photo" },
    { name: "Ù…Ø¹Ø§Ø·Ù", image: "https://csspicker.dev/api/image/?q=coat&image_type=photo" },
    { name: "Ø¬ÙŠÙ†Ø²", image: "https://csspicker.dev/api/image/?q=jeans&image_type=photo" },
  ];

  const bigDeals = [
    { image: "https://csspicker.dev/api/image/?q=black+midi+dress&image_type=photo", price: "179.00 Ø±.Ø³" },
    { image: "https://csspicker.dev/api/image/?q=brown+dress+model&image_type=photo", price: "179.00 Ø±.Ø³" },
    { image: "https://csspicker.dev/api/image/?q=white+dress&image_type=photo", price: "179.00 Ø±.Ø³" },
    { image: "https://csspicker.dev/api/image/?q=black+sleeveless+dress&image_type=photo", price: "179.00 Ø±.Ø³" },
    { image: "https://csspicker.dev/api/image/?q=beige+skirt&image_type=photo", price: "95.00 Ø±.Ø³" },
    { image: "https://csspicker.dev/api/image/?q=pink+top&image_type=photo", price: "48.00 Ø±.Ø³" },
  ];

  const hotTrends = [
    { image: "https://csspicker.dev/api/image/?q=black+skirt&image_type=photo", price: "66.00 Ø±.Ø³" },
    { image: "https://csspicker.dev/api/image/?q=white+blouse&image_type=photo", price: "95.00 Ø±.Ø³" },
    { image: "https://csspicker.dev/api/image/?q=white+summer+dress&image_type=photo", price: "159.00 Ø±.Ø³" },
    { image: "https://csspicker.dev/api/image/?q=black+blouse&image_type=photo", price: "79.00 Ø±.Ø³" },
    { image: "https://csspicker.dev/api/image/?q=leather+handbag&image_type=photo", price: "129.00 Ø±.Ø³" },
    { image: "https://csspicker.dev/api/image/?q=white+sneakers&image_type=photo", price: "139.00 Ø±.Ø³" },
  ];

  const promoTiles = [
    { title: "Ø´Ø­Ù† Ù…Ø¬Ø§Ù†ÙŠ", sub: "Ù„Ù„Ø·Ù„Ø¨Ø§Øª ÙÙˆÙ‚ 99 Ø±.Ø³", image: "https://csspicker.dev/api/image/?q=free+shipping+icon&image_type=photo", bg: "#ffffff" },
    { title: "Ø®ØµÙ… 90%", sub: "Ù„ÙØªØ±Ø© Ù…Ø­Ø¯ÙˆØ¯Ø©", image: "https://csspicker.dev/api/image/?q=sale+tag&image_type=photo", bg: "#fff6f1" },
    { title: "Ø§Ù„Ø¯ÙØ¹ Ø¹Ù†Ø¯ Ø§Ù„Ø§Ø³ØªÙ„Ø§Ù…", sub: "Ù…ØªØ§Ø­ Ù„Ù…Ø¯Ù† Ù…Ø®ØªØ§Ø±Ø©", image: "https://csspicker.dev/api/image/?q=cod+payment&image_type=photo", bg: "#f7faff" },
    { title: "Ù†Ù‚Ø§Ø· ÙˆÙ…ÙƒØ§ÙØ¢Øª", sub: "Ø§ÙƒØ³Ø¨ Ù…Ø¹ ÙƒÙ„ Ø´Ø±Ø§Ø¡", image: "https://csspicker.dev/api/image/?q=reward+points&image_type=photo", bg: "#f9f9ff" },
    { title: "Ø®ØµÙ… Ø§Ù„Ø·Ù„Ø§Ø¨", sub: "ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø£Ù‡Ù„ÙŠØ©", image: "https://csspicker.dev/api/image/?q=student+discount&image_type=photo", bg: "#fffaf3" },
    { title: "Ø¹Ø±ÙˆØ¶ Ø§Ù„ÙŠÙˆÙ…", sub: "Ù„Ø§ ØªÙÙˆÙ‘Øª Ø§Ù„ÙØ±ØµØ©", image: "https://csspicker.dev/api/image/?q=deal+of+the+day&image_type=photo", bg: "#f5fffb" },
  ];

  const midPromo = {
    image: "https://images.unsplash.com/photo-1512203492609-8b0f0b52f483?w=1600&q=60",
    alt: "Ø¹Ø±Ø¶ Ø´Ø±ÙŠØ·ÙŠ 90Ã—720",
    text: "Ù‚Ø³Ø§Ø¦Ù… Ø¥Ø¶Ø§ÙÙŠØ© + Ø´Ø­Ù† Ù…Ø¬Ø§Ù†ÙŠ",
  };

  // UI state
  const [scrolled, setScrolled] = useState(false);
  const [activeTab, setActiveTab] = useState(0);
  const tabs = ["ÙƒÙ„", "Ù†Ø³Ø§Ø¡", "Ø±Ø¬Ø§Ù„", "Ø£Ø·ÙØ§Ù„", "Ø£Ø­Ø¬Ø§Ù… ÙƒØ¨ÙŠØ±Ø©", "Ø¬Ù…Ø§Ù„", "Ø§Ù„Ù…Ù†Ø²Ù„", "Ø£Ø­Ø°ÙŠØ©", "ÙØ³Ø§ØªÙŠÙ†"];
  const tabsRef = useRef<HTMLDivElement>(null);

  useEffect(() => {
    const onScroll = () => setScrolled(window.scrollY > 60);
    onScroll();
    window.addEventListener("scroll", onScroll, { passive: true });
    return () => window.removeEventListener("scroll", onScroll);
  }, []);

  const onTabsKeyDown = (e: React.KeyboardEvent) => {
    if (e.key === "ArrowRight") setActiveTab((a) => Math.min(a + 1, tabs.length - 1));
    if (e.key === "ArrowLeft") setActiveTab((a) => Math.max(a - 1, 0));
    const el = tabsRef.current?.children[activeTab] as HTMLElement | undefined;
    el?.scrollIntoView({ inline: "center", behavior: "smooth" });
  };

  // Ø¨Ù„Ø§Ø· Ù…Ø¨Ø³Ù‘Ø· Ù„Ù„ØµÙˆØ±Ø© + Ø§Ù„Ø³Ø¹Ø± ÙÙ‚Ø·
  const SimpleTile = ({ image, price }: { image: string; price: string }) => (
    <button className="text-start snap-item simple-item" aria-label={`Ù…Ù†ØªØ¬ Ø¨Ø³Ø¹Ø± ${price}`}>
      <div className="border border-gray-200 rounded-[4px] overflow-hidden bg-white">
        <img src={image} alt={price} className="w-full aspect-[255/192] object-cover" loading="lazy" />
      </div>
      <div className="mt-1">
        <span className="text-red-600 font-bold text-sm">{price}</span>
      </div>
    </button>
  );

// Ø¨Ø·Ø§Ù‚Ø© Ø§Ù„Ù…Ù†ØªØ¬
const ProductCard = ({
  image,
  overlayBannerSrc,
  overlayBannerAlt,
  title,
  brand,
  discountPercent,
  bestRank,
  bestRankCategory,
  basePrice,
  soldPlus,
  couponPrice,
  colors,
  colorCount,
  imageAspect = "aspect-[4/5]", // âš¡ Ù‡Ù†Ø§ ØªØªØ­ÙƒÙ… Ø¨Ù†Ø³Ø¨Ø© Ø£Ø¨Ø¹Ø§Ø¯ Ø§Ù„ØµÙˆØ±Ø© (ØºÙŠÙ‘Ø±Ù‡Ø§ Ù…Ø«Ù„Ø§Ù‹ aspect-square Ù„Ù…Ø±Ø¨Ø¹)
}: {
  image: string;
  overlayBannerSrc?: string;
  overlayBannerAlt?: string;
  title: string;
  brand?: string;
  discountPercent?: number;
  bestRank?: number;
  bestRankCategory?: string;
  basePrice?: string;
  soldPlus?: string;
  couponPrice?: string;
  colors?: string[];
  colorCount?: number;
  imageAspect?: string;
}) => {
  // ğŸ¨ Ø£Ù„ÙˆØ§Ù† Ù…Ø¹Ø±ÙØ© Ù…Ø³Ø¨Ù‚Ø§Ù‹ (ÙŠÙ…ÙƒÙ†Ùƒ ØªØºÙŠÙŠØ± Ø§Ù„Ø£ÙƒÙˆØ§Ø¯ Ù‡Ù†Ø§ Ù„ØªØºÙŠÙŠØ± Ø§Ù„Ø«ÙŠÙ…)
  const purple = "#6D28D9"; // Ø¨Ù†ÙØ³Ø¬ÙŠ
  const graySegment = "#F3F4F6"; // Ø±Ù…Ø§Ø¯ÙŠ ÙØ§ØªØ­
  const grayText = "#374151"; // Ø±Ù…Ø§Ø¯ÙŠ ØºØ§Ù…Ù‚
  const orangeText = "#F97316"; // Ø¨Ø±ØªÙ‚Ø§Ù„ÙŠ Ù„Ù„Ù†Øµ
  const orangeBorder = "#FB923C"; // Ø¨Ø±ØªÙ‚Ø§Ù„ÙŠ Ù„Ù„Ø­Ø¯ÙˆØ¯
  const yellowDark = "#F59E0B"; // Ø£ØµÙØ± ØºØ§Ù…Ù‚
  const yellowLight = "#FEF3C7"; // Ø£ØµÙØ± ÙØ§ØªØ­

  return (
    <div className="masonry-item">
      {/* ğŸŸ¦ Ø§Ù„Ø­Ø§ÙˆÙŠØ© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© Ù„Ù„Ø¨Ø·Ø§Ù‚Ø© */}
      <div className="w-full border border-gray-200 rounded-[4px] bg-white overflow-hidden">
        
        {/* ğŸ–¼ï¸ ØµÙˆØ±Ø© Ø§Ù„Ù…Ù†ØªØ¬ */}
        <div className={`relative w-full ${imageAspect}`}>
          <img
            src={image}
            alt={title}
            className="absolute inset-0 w-full h-full object-cover" 
            loading="lazy"
          />

          {/* ğŸ¨ Ø¹Ù…ÙˆØ¯ Ø§Ù„Ø£Ù„ÙˆØ§Ù† ÙˆØ¹Ø¯Ø¯Ù‡Ø§ */}
          {(colors?.length || typeof colorCount === "number") && (
            <div className="absolute bottom-2 right-2 flex flex-col items-center">
            <div className="flex flex-col items-center gap-0.5 bg-black/40 p-0.5 rounded-full">
            {colors?.slice(0, 3).map((c, idx) => (
              <span
              key={`clr-${idx}`}
              className="w-3 h-3 rounded-full border border-white/20"
              style={{ backgroundColor: c }}
              />
              ))}
              {typeof colorCount === "number" && (
                <span className="mt-0.5 text-[9px] font-medium px-1 py-0.5 rounded-full text-white/80 bg-white/5">
                {colorCount}
                </span>
                )}
                </div>
                </div>
                )}
                </div>

        {/* ğŸ“¢ Ø´Ø±ÙŠØ· ØªØ³ÙˆÙŠÙ‚ÙŠ Ø£Ø³ÙÙ„ Ø§Ù„ØµÙˆØ±Ø© */}
        {overlayBannerSrc && (
          <div className="w-full h-7 relative">
            <img
              src={overlayBannerSrc}
              alt={overlayBannerAlt || "Ø´Ø±ÙŠØ· ØªØ³ÙˆÙŠÙ‚ÙŠ"}
              className="absolute inset-0 w-full h-full object-cover"
              loading="lazy"
            />
          </div>
        )}

        {/* ğŸ“¦ Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ø³ÙÙ„ÙŠ */}
        <div className="px-2 py-2 relative">
          
          {/* ğŸ” Ø´Ø±ÙŠØ· ØªØ±Ù†Ø¯Ø§Øª + Ø§Ù„Ù…ØªØ¬Ø± */}
          <div className="inline-flex items-center rounded-[4px] overflow-hidden border border-gray-200">
            {/* ØªØ±Ù†Ø¯Ø§Øª */}
            <button
              className="inline-flex items-center px-2 text-[11px] font-semibold text-white rounded-[4px]"
              style={{ backgroundColor: purple }}
            >
              ØªØ±Ù†Ø¯Ø§Øª
            </button>
            {/* Ø§Ù„Ù…ØªØ¬Ø±: Ø£ÙŠÙ‚ÙˆÙ†Ø© Ø­Ø¯ÙŠØ«Ø© ÙØ§Ø±ØºØ© ÙˆØ¨Ù†ÙØ³Ø¬ÙŠØ© */}
            <button
              className="inline-flex items-center gap-1 px-2 text-[11px] font-medium rounded-[4px]"
              style={{ backgroundColor: graySegment, color: purple }}
              aria-label={`Ø±Ù…ÙˆØ² Ù…ØªØ¬Ø± ${brand || ""}`}
            >
              <Store className="w-3.5 h-3.5" color={purple} strokeWidth={2} />
              <span className="line-clamp-1">{brand || ""}</span>
              <span style={{ color: purple }}>{">"}</span>
            </button>
          </div>

          {/* ğŸ·ï¸ Ù…Ø±Ø¨Ø¹ Ø§Ù„Ø®ØµÙ… + Ø§Ø³Ù… Ø§Ù„Ù…Ù†ØªØ¬ */}
          <div className="mt-0.5 flex items-center gap-1.5">
            {typeof discountPercent === "number" && (
              <div
                className="px-1 h-4 rounded-[3px] text-[11px] font-semibold border flex items-center leading-[1.1]"
                style={{
                  borderColor: orangeBorder,
                  color: orangeText,
                }}
              >
                -%{discountPercent}
              </div>
            )}
            <div className="text-[12px] text-gray-900 font-medium line-clamp-1 leading-[1.15]">
              {title}
            </div>
          </div>

          {/* â­ Ø§Ù„Ø£ÙØ¶Ù„ Ù…Ø¨ÙŠØ¹Ø§Ù‹ */}
          {(typeof bestRank === "number" || bestRankCategory) && (
            <div className="mt-0.5 inline-flex items-stretch rounded-[4px] overflow-hidden">
              {typeof bestRank === "number" && (
                <div
                  className="px-1 text-[9px] font-medium flex items-center leading-[1.1]"
                  style={{
                    backgroundColor: "rgba(255, 232, 174)",
                    color: '#c77210',
                  }}
                >
                  #{bestRank} Ø§Ù„Ø£ÙØ¶Ù„ Ù…Ø¨ÙŠØ¹Ø§Ù‹
                </div>
              )}
              {bestRankCategory && (
                <button
                  className="px-1 text-[9px] font-semibold flex items-center gap-1 leading-[1.1]"
                  style={{
                    backgroundColor: "rgba(254, 243, 199, 0.2)",
                    color: '#d58700',
                    borderLeft: 0,
                  }}
                  aria-label={`Ø§Ø°Ù‡Ø¨ Ø¥Ù„Ù‰ Ø§Ù„ÙØ¦Ø© ${bestRankCategory}`}
                >
                  <span>ÙÙŠ {bestRankCategory}</span>
                  <span>{">"}</span>
                </button>
              )}
            </div>
          )}

          {/* ğŸ’° Ø§Ù„Ø³Ø¹Ø± Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ + ØªÙ… Ø§Ù„Ø¨ÙŠØ¹ (Ø²Ø± Ø§Ù„Ø³Ù„Ø© Ù…Ø³ØªÙ‚Ù„ ÙˆÙ…Ø«Ø¨Øª Ø£Ø³ÙÙ„ ÙŠÙ…ÙŠÙ† Ø§Ù„Ù…Ø­ØªÙˆÙ‰) */}
          {(basePrice || soldPlus) && (
            <div className="mt-0.5 flex items-center gap-1.5">
              {basePrice && (
                <span
                  className="text-[13px] font-bold leading-[1.1]"
                  style={{ color: orangeText }}
                >
                  {basePrice} Ø±ÙŠØ§Ù„
                </span>
              )}
              {soldPlus && (
                <span className="text-[11px] text-gray-700 leading-[1.1]">{soldPlus}</span>
              )}
            </div>
          )}

          {/* ğŸ›’ Ø²Ø± Ø§Ù„Ø³Ù„Ø©: Ù…Ø³ØªÙ‚Ù„ Ø¹Ù† Ø§Ù„Ø£Ø³Ø·Ø±ØŒ Ù…ÙˆØ¶ÙˆØ¹ Ø¨Ø´ÙƒÙ„ Ù…Ø·Ù„Ù‚ */}
          {(basePrice || soldPlus) && (
            <button
              className="absolute left-2 bottom-6 flex items-center gap-1 px-2 py-1 rounded-full border bg-white border-black"
              aria-label="Ø£Ø¶Ù Ø¥Ù„Ù‰ Ø§Ù„Ø³Ù„Ø©"
            >
              <ShoppingCart className="w-4 h-4 text-black" />
              <span className="text-[11px] font-semibold text-black">
                1+
              </span>
            </button>
          )}

          {/* ğŸŸï¸ Ø§Ù„Ø³Ø¹Ø± Ø¨Ø¹Ø¯ Ø§Ù„ÙƒÙˆØ¨ÙˆÙ† */}
          {couponPrice && (
            <div
              className="mt-0.5 h-7 inline-flex items-center gap-1 px-2 rounded-[3px]"
              style={{
                backgroundColor: "rgba(249, 115, 22, 0.10)",
              }}
            >
              <span
                className="text-[13px] font-extrabold leading-[1.1]"
                style={{ color: orangeText }}
              >
                {couponPrice} Ø±ÙŠØ§Ù„
              </span>
              <span className="text-[11px]" style={{ color: orangeText }}>
                /Ø¨Ø¹Ø¯ Ø§Ù„ÙƒÙˆØ¨ÙˆÙ†
              </span>
            </div>
          )}
        </div>
      </div>
    </div>
  );
};

  // Ù…Ù† Ø£Ø¬Ù„Ùƒ: Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ø·Ø§Ø¨Ù‚Ø© Ù„Ù„ØµÙˆØ±Ø©
  const forYou = [
    {
      image: "https://csspicker.dev/api/image/?q=black+dress+model&image_type=photo",
      overlayBannerSrc: "https://csspicker.dev/api/image/?q=anniversary+party+banner+pink+yellow&image_type=photo",
      overlayBannerAlt: "Ø­ÙÙ„Ø© Ø§Ù„Ø°ÙƒØ±Ù‰ Ø§Ù„Ø³Ù†ÙˆÙŠØ©",
      title: "COSMINA Ù…Ù„Ø§Ø¨Ø³ Ø¹Ù„ÙˆÙŠØ© ÙƒØ§ ...",
      brand: "COSMINA",
      discountPercent: 25,
      bestRank: 4,
      bestRankCategory: "Ø£Ù†ÙŠÙ‚ Ù‚Ù…Ù… Ù†Ø³Ø§Ø¦ÙŠØ©",
      basePrice: "21.06",
      soldPlus: "ØªÙ… Ø¨ÙŠØ¹ 100+",
      couponPrice: "16.85",
      colors: ["#111111", "#6B7280", "#EEE5D4", "#F9A8D4"],
      colorCount: 9,
      imageAspect: "aspect-[4/5]",
    },
    {
      image: "https://csspicker.dev/api/image/?q=sleeveless+top+black+white&image_type=photo",
      overlayBannerSrc: "https://csspicker.dev/api/image/?q=anniversary+party+banner+pink+yellow&image_type=photo",
      overlayBannerAlt: "Ø­ÙÙ„Ø© Ø§Ù„Ø°ÙƒØ±Ù‰ Ø§Ù„Ø³Ù†ÙˆÙŠØ©",
      title: "Ø¨Ù„ÙˆØ²Ø© Ù†Ø³Ø§Ø¦ÙŠØ© Ø¨Ø¯ÙˆÙ† ÙƒÙ…ØŒ Ø®ØµØ± Ù…Ø±ØªÙØ¹",
      brand: "Frierie CURVE",
      discountPercent: 76,
      basePrice: "120.00",
      soldPlus: "ØªÙ… Ø¨ÙŠØ¹ 410+",
      couponPrice: "29.00",
      colors: ["#000000", "#FFFFFF", "#A3A3A3", "#FECACA"],
      colorCount: 6,
      imageAspect: "aspect-[5/4]",
    },
    {
      image: "https://csspicker.dev/api/image/?q=casual+shirt+dazy&image_type=photo",
      overlayBannerSrc: "https://csspicker.dev/api/image/?q=anniversary+party+banner+pink+yellow&image_type=photo",
      overlayBannerAlt: "Ø­ÙÙ„Ø© Ø§Ù„Ø°ÙƒØ±Ù‰ Ø§Ù„Ø³Ù†ÙˆÙŠØ©",
      title: "Ù‚Ù…ÙŠØµ Ø¨Ø¬ÙŠÙˆØ¨ Ù†Ø³Ø§Ø¦ÙŠ Ø¨Ø³ÙŠØ·",
      brand: "Dazy",
      basePrice: "120.00",
      couponPrice: "69.00",
      colors: ["#FFFFFF", "#9CA3AF", "#E5E7EB", "#FDE68A"],
      colorCount: 3,
      imageAspect: "aspect-[3/4]",
    },
    {
      image: "https://csspicker.dev/api/image/?q=white+outfit+woman+outdoor&image_type=photo",
      overlayBannerSrc: "https://csspicker.dev/api/image/?q=anniversary+party+banner+pink+yellow&image_type=photo",
      overlayBannerAlt: "Ø­ÙÙ„Ø© Ø§Ù„Ø°ÙƒØ±Ù‰ Ø§Ù„Ø³Ù†ÙˆÙŠØ©",
      title: "Ø¥Ø·Ù„Ø§Ù„Ø© Ø£Ù†ÙŠÙ‚Ø© Ø¨ÙŠØ¶Ø§Ø¡",
      basePrice: "159.00",
      colors: ["#FFFFFF", "#F3F4F6", "#D1D5DB", "#A7F3D0"],
      colorCount: 5,
      imageAspect: "aspect-[3/4]",
    },
  ];

  const headerH = scrolled ? 48 : 64;

  // Categories: 3 rows horizontally scrollable
  const rows = 3;
  const perRow = Math.ceil(categories.length / rows);
  const catRows = Array.from({ length: rows }, (_, i) =>
    categories.slice(i * perRow, (i + 1) * perRow)
  );

  return (
    <div className={`min-h-screen bg-[#f7f7f7] ${className}`} dir="rtl">
      <style>{`
        .no-scrollbar { scrollbar-width: none; -ms-overflow-style: none; }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .snap-x-start { scroll-snap-type: x mandatory; }
        .snap-item { scroll-snap-align: start; }

        /* Ø§Ù„ÙØ¦Ø§Øª: Ø¥Ø¸Ù‡Ø§Ø± 4.7 Ø¹Ù†ØµØ± Ø¨Ø¯Ù‚Ø© Ù…Ø¹ gap = 12px */
        .cat-row { --visible: 4.7; --gap: 12px; }
        .cat-row-inner { display: flex; gap: var(--gap); }
        .cat-item { flex: 0 0 calc((100% - (var(--visible) - 1) * var(--gap)) / var(--visible)); }

        /* ÙƒØ±ÙˆØ³Ø§Øª â€œØ¹Ø±ÙˆØ¶ ÙƒØ¨Ø±Ù‰/Ø£Ù‡Ù… Ø§Ù„ØªØ±Ù†Ø¯Ø§Øªâ€ */
        .simple-row { --visible: 4.15; --gap: 6px; }
        .simple-row-inner { display: flex; gap: var(--gap); }
        .simple-item { flex: 0 0 calc((100% - (var(--visible) - 1) * var(--gap)) / var(--visible)); }

        /* Masonry Ù„Ù…Ù† Ø£Ø¬Ù„Ùƒ: Ø¨Ø¯ÙˆÙ† ÙØ±Ø§ØºØ§Øª Ø¹Ù…ÙˆØ¯ÙŠØ© Ø¨ÙŠÙ† Ø§Ù„Ø¨Ø·Ø§Ù‚Ø§Øª */
        .masonry { column-count: 2; column-gap: 6px; }
        .masonry-item { break-inside: avoid; margin-bottom: 6px; display: inline-block; width: 100%; }
      `}</style>

      {/* Header */}
      <div
        className={`fixed top-0 left-0 right-0 z-50 transition-all duration-200 ${
          scrolled ? "bg-white/95 backdrop-blur-sm h-12" : "bg-transparent h-16"
        }`}
        aria-label="Ø±Ø£Ø³ Ø§Ù„ØµÙØ­Ø©"
      >
        <div className="max-w-md mx-auto h-full px-3 flex items-center justify-between">
          <div className="flex items-center gap-1">
            <button className="w-11 h-11 flex items-center justify-center rounded-[4px]" aria-label="Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©">
              <Menu className={`w-6 h-6 ${scrolled ? "text-gray-800" : "text-white"}`} />
            </button>
            <button className="w-11 h-11 flex items-center justify-center rounded-[4px]" aria-label="Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª">
              <Bell className={`w-6 h-6 ${scrolled ? "text-gray-800" : "text-white"}`} />
            </button>
          </div>
          <div className={`text-base font-semibold ${scrolled ? "text-gray-900" : "text-white"}`} aria-label="Ø´Ø¹Ø§Ø± Ø§Ù„Ù…ØªØ¬Ø±">
            jeeey
          </div>
          <div className="flex items-center gap-1">
            <button className="w-11 h-11 flex items-center justify-center rounded-[4px]" aria-label="Ø§Ù„Ø³Ù„Ø©">
              <ShoppingCart className={`w-6 h-6 ${scrolled ? "text-gray-800" : "text-white"}`} />
            </button>
            <button className="w-11 h-11 flex items-center justify-center rounded-[4px]" aria-label="Ø§Ù„Ø¨Ø­Ø«">
              <Search className={`w-6 h-6 ${scrolled ? "text-gray-800" : "text-white"}`} />
            </button>
          </div>
        </div>
      </div>

      {/* TabsBar */}
      <div
        className={`${scrolled ? "bg-white/95 backdrop-blur-sm" : "bg-transparent"} fixed left-0 right-0 z-40 transition-colors`}
        style={{ top: headerH }}
        role="tablist"
        aria-label="Ø§Ù„ØªØ¨ÙˆÙŠØ¨Ø§Øª"
      >
        <div
          ref={tabsRef}
          className="max-w-md mx-auto overflow-x-auto no-scrollbar px-3 py-2 flex gap-4"
          onKeyDown={onTabsKeyDown}
        >
          {tabs.map((t, i) => (
            <button
              key={t}
              role="tab"
              aria-selected={activeTab === i}
              tabIndex={0}
              onClick={() => setActiveTab(i)}
              className={`text-sm whitespace-nowrap relative pb-1 ${
                activeTab === i ? "text-black font-semibold" : scrolled ? "text-gray-700" : "text-white"
              }`}
            >
              {t}
              <span
                className={`absolute left-0 right-0 -bottom-0.5 h-0.5 transition-all ${
                  activeTab === i ? (scrolled ? "bg-black" : "bg-white") : "bg-transparent"
                }`}
              />
            </button>
          ))}
        </div>
      </div>

      {/* Banner */}
      <div className="max-w-md mx-auto">
        <div className="relative w-full h-[360px] sm:h-[420px]">
          <img
            src="https://images.unsplash.com/photo-1512436991641-6745cdb1723f?w=1200&q=60"
            srcSet="https://images.unsplash.com/photo-1512436991641-6745cdb1723f?w=1200&q=60&fm=webp 1200w, https://images.unsplash.com/photo-1512436991641-6745cdb1723f?w=2400&q=60&fm=webp 2400w"
            alt="Ø¹Ø±Ø¶ ØªØ®ÙÙŠØ¶Ø§Øª"
            className="absolute inset-0 w-full h-full object-cover"
            loading="eager"
          />
          <div className="absolute inset-0 bg-gradient-to-b from-black/50 via-black/20 to-transparent pointer-events-none" />
          <div className="absolute bottom-4 right-4 left-4 text-white">
            <div className="text-sm mb-1">Ø§Ø­ØªÙØ§Ù„Ù†Ø§ Ø§Ù„Ø£ÙƒØ¨Ø± Ø¹Ù„Ù‰ Ø§Ù„Ø¥Ø·Ù„Ø§Ù‚</div>
            <div className="text-4xl sm:text-5xl font-extrabold leading-tight">Ø®ØµÙ… ÙŠØµÙ„ Ø­ØªÙ‰ 90%</div>
            <button className="mt-3 bg-white text-black px-4 py-2 rounded-[4px] text-sm font-semibold" aria-label="ØªØ³ÙˆÙ‘Ù‚ Ø§Ù„Ø¢Ù†">
              ØªØ³ÙˆÙ‘Ù‚ Ø§Ù„Ø¢Ù†
            </button>
          </div>
        </div>
      </div>

      {/* Ø´Ø±ÙŠØ· Ø¹Ø±ÙˆØ¶ ØªØ±ÙˆÙŠØ¬ÙŠØ© ØªØ­Øª Ø§Ù„Ù€ Banner */}
      <section className="max-w-md mx-auto px-3 py-3">
        <div className="bg-white border border-gray-200 rounded-[4px] px-3 py-3">
          <div className="overflow-x-auto no-scrollbar snap-x-start flex gap-1.5" aria-label="Ø¹Ø±ÙˆØ¶ ØªØ±ÙˆÙŠØ¬ÙŠØ© Ø£ÙÙ‚ÙŠØ©">
            {promoTiles.map((item) => (
              <div
                key={item.title}
                className="snap-item w-[192px] h-[68px] flex-shrink-0 rounded-[4px] border border-gray-200 relative overflow-hidden"
                style={{ backgroundColor: item.bg }}
              >
                <img
                  src={item.image}
                  alt={item.title}
                  className="absolute right-0 top-0 w-16 h-full object-cover opacity-90"
                  loading="lazy"
                />
                <div className="absolute inset-y-0 left-2 right-20 flex flex-col justify-center">
                  <div className="text-[12px] font-semibold text-gray-900">{item.title}</div>
                  <div className="text-[11px] text-gray-600">{item.sub}</div>
                </div>
              </div>
            ))}
          </div>
        </div>
      </section>

      {/* ØµÙˆØ±Ø© Ø´Ø±ÙŠØ·ÙŠØ© 90Ã—720 */}
      <div className="max-w-md mx-auto px-3 py-3">
        <div className="w-full h-[90px] rounded-[4px] overflow-hidden relative border border-gray-200 bg-white">
          <img
            src={midPromo.image}
            alt={midPromo.alt}
            className="absolute inset-0 w-full h-full object-cover"
            loading="lazy"
          />
          <div className="absolute inset-0 bg-black/10" />
          <div className="absolute right-3 left-3 top-1/2 -translate-y-1/2 text-white text-[12px] font-semibold">
            {midPromo.text}
          </div>
        </div>
      </div>

      {/* Content */}
      <div className="max-w-md mx-auto">
        {/* Categories */}
        <section className="px-3 py-3" aria-label="Ø§Ù„ÙØ¦Ø§Øª">
          <div className="bg-white border border-gray-200 rounded-[4px] px-3 py-3">
            <h2 className="text-sm font-semibold text-gray-900 mb-2">Ø§Ù„ÙØ¦Ø§Øª</h2>
            {catRows.map((row, idx) => (
              <div key={idx} className="overflow-x-auto no-scrollbar snap-x-start mb-1.5 cat-row">
                <div className="cat-row-inner">
                  {row.map((c) => (
                    <button
                      key={`${c.name}-${idx}`}
                      className="snap-item cat-item text-center"
                      aria-label={`ÙØ¦Ø© ${c.name}`}
                    >
                      <div className="w-[68px] h-[68px] rounded-full overflow-hidden mx-auto mb-1.5 border border-gray-200 bg-white">
                        <img src={c.image} alt={c.name} className="w-full h-full object-cover" loading="lazy" />
                      </div>
                      <div className="text-[11px] text-gray-700 line-clamp-2">{c.name}</div>
                    </button>
                  ))}
                </div>
              </div>
            ))}
          </div>
        </section>

        {/* Ø¹Ø±ÙˆØ¶ ÙƒØ¨Ø±Ù‰ */}
        <section className="px-3 py-3" aria-label="Ø¹Ø±ÙˆØ¶ ÙƒØ¨Ø±Ù‰">
          <div className="bg-white border border-gray-200 rounded-[4px] px-3 py-3">
            <div className="mb-1.5 flex items-center justify-between">
              <h2 className="text-sm font-semibold text-gray-900">Ø¹Ø±ÙˆØ¶ ÙƒØ¨Ø±Ù‰</h2>
              <button className="flex items-center text-xs text-gray-700" aria-label="Ø¹Ø±Ø¶ Ø§Ù„Ù…Ø²ÙŠØ¯ ÙÙŠ Ø¹Ø±ÙˆØ¶ ÙƒØ¨Ø±Ù‰">
                <span className="mr-1">Ø§Ù„Ù…Ø²ÙŠØ¯</span>
                <ChevronLeft className="w-4 h-4" />
              </button>
            </div>
            <div className="overflow-x-auto no-scrollbar snap-x-start simple-row">
              <div className="simple-row-inner">
                {bigDeals.map((p, i) => (
                  <SimpleTile key={`deal-${i}`} image={p.image} price={p.price} />
                ))}
              </div>
            </div>
          </div>
        </section>

        {/* Ø£Ù‡Ù… Ø§Ù„ØªØ±Ù†Ø¯Ø§Øª */}
        <section className="px-3 py-3" aria-label="Ø£Ù‡Ù… Ø§Ù„ØªØ±Ù†Ø¯Ø§Øª">
          <div className="bg-white border border-gray-200 rounded-[4px] px-3 py-3">
            <div className="mb-1.5 flex items-center justify-between">
              <h2 className="text-sm font-semibold text-gray-900">Ø£Ù‡Ù… Ø§Ù„ØªØ±Ù†Ø¯Ø§Øª</h2>
              <button className="flex items-center text-xs text-gray-700" aria-label="Ø¹Ø±Ø¶ Ø§Ù„Ù…Ø²ÙŠØ¯ ÙÙŠ Ø£Ù‡Ù… Ø§Ù„ØªØ±Ù†Ø¯Ø§Øª">
                <span className="mr-1">Ø§Ù„Ù…Ø²ÙŠØ¯</span>
                <ChevronLeft className="w-4 h-4" />
              </button>
            </div>
            <div className="overflow-x-auto no-scrollbar snap-x-start simple-row">
              <div className="simple-row-inner">
                {hotTrends.map((p, i) => (
                  <SimpleTile key={`trend-${i}`} image={p.image} price={p.price} />
                ))}
              </div>
            </div>
          </div>
        </section>

        {/* Ù…Ù† Ø£Ø¬Ù„Ùƒ: Masonry Ø¨Ø¨Ø·Ø§Ù‚Ø© Ù…Ø·Ø§Ø¨Ù‚Ø© Ù„Ù„ØµÙˆØ±Ø© */}
        <section className="px-3 py-3" aria-label="Ù…Ù† Ø£Ø¬Ù„Ùƒ">
          <div className="bg-white border border-gray-200 rounded-[4px] px-3 py-3">
            <h2 className="text-sm font-semibold text-gray-900 text-center">Ù…Ù† Ø£Ø¬Ù„Ùƒ</h2>
          </div>

          <div className="mt-0 masonry">
            {forYou.map((p, i) => (
              <ProductCard
                key={`fy-${i}`}
                image={p.image}
                overlayBannerSrc={p.overlayBannerSrc}
                overlayBannerAlt={p.overlayBannerAlt}
                title={p.title}
                brand={p.brand}
                discountPercent={p.discountPercent}
                bestRank={p.bestRank}
                bestRankCategory={p.bestRankCategory}
                basePrice={p.basePrice}
                soldPlus={p.soldPlus}
                couponPrice={p.couponPrice}
                colors={p.colors}
                colorCount={p.colorCount}
                imageAspect={p.imageAspect}
              />
            ))}
          </div>

          <div className="mt-4" />
        </section>

        <div className="h-20" />
      </div>

      {/* BottomNav */}
      <nav className="fixed bottom-0 left-0 right-0 bg-white border-t border-gray-200 z-50" aria-label="Ø§Ù„ØªÙ†Ù‚Ù„ Ø§Ù„Ø³ÙÙ„ÙŠ">
        <div className="max-w-md mx-auto flex justify-around py-2" dir="rtl">
          <button className="text-center w-16" aria-label="Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©">
            <LayoutGrid className="w-6 h-6 mx-auto mb-1 text-black" />
            <div className="text-[11px] text-black">Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</div>
          </button>
          <button className="text-center w-16" aria-label="Ø§Ù„ÙØ¦Ø§Øª">
            <LayoutGrid className="w-6 h-6 mx-auto mb-1 text-gray-700" />
            <div className="text-[11px] text-gray-700">Ø§Ù„ÙØ¦Ø§Øª</div>
          </button>
          <button className="text-center w-16" aria-label="Ø¬Ø¯ÙŠØ¯/Ø¨Ø­Ø«">
            <Search className="w-6 h-6 mx-auto mb-1 text-gray-700" />
            <div className="text-[11px] text-gray-700">Ø¬Ø¯ÙŠØ¯</div>
          </button>
          <button className="text-center w-16" aria-label="Ø­Ù‚ÙŠØ¨Ø© Ø§Ù„ØªØ³ÙˆÙ‚">
            <ShoppingBag className="w-6 h-6 mx-auto mb-1 text-gray-700" />
            <div className="text-[11px] text-gray-700">Ø§Ù„Ø­Ù‚ÙŠØ¨Ø©</div>
          </button>
          <button className="text-center w-16" aria-label="Ø­Ø³Ø§Ø¨ÙŠ">
            <User className="w-6 h-6 mx-auto mb-1 text-gray-700" />
            <div className="text-[11px] text-gray-700">Ø­Ø³Ø§Ø¨ÙŠ</div>
          </button>
        </div>
      </nav>
    </div>
  );
};

export default SheinHome;
